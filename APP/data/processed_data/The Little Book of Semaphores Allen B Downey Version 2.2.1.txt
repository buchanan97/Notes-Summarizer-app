little book semaphore allen downey version little book semaphore second edition version copyright allen downey permission granted copy distribute modify thi s document term creative common attributio international cc http original form book latex source code compilin g latex source eﬀect generating rep resentation book converted format printed book typeset author using latex dvips pdf free program latex source book available fromhttp undergraduate operating system textbook modu le nization usually present set primitive mutex e semaphore itors condition variable classical p roblems like writer took operating system class berkeley taug ht colby college got impression student able understand solution problem able p roduce solve similar problem reason student don t understand material deeply s take time practice class spare sy nchronization just module competing space operating sy stem class m sure argue important t hink challenging interesting right fun iwrotetheﬁrsteditionthisbookwiththegoalofidentifyin gsynchronization idiom pattern understood isolation d assembled solve complex problem challenge syn chronization code doesn t compose number component increase number interaction grows unmanageably pattern solution saw di scovered systematic approach assembling solution t hat demonstrably correct chance test approach taught operating sy stem wellesley college used ﬁrst edition little book semaphore standard textbook taught synchr onization concurrent thread duration course week gave student page book ending puzzle hint told look hint unless stumped gave tool testing solution sma ll magnetic whiteboard write code stack magnet s represent thread executing code result dramatic given time absorb mate rial dent demonstrated depth understanding seen fore importantly able solve puzzl e case reinvented classical solution case t hey creative new preface moved olin college took step created called synchronization covered little book semaphore implementation synchronization primitive sembly language posix python student took class helped ﬁnd error ﬁrs t edition contributed solution better end semester asked write new original pro blem preferably solution added contribution sec ond edition ﬁrst edition appeared kenneth reek presente d article design pattern semaphore acm special interes t group puter science education present problem cast sushi bar problem solution demonstrate pattern call pas baton ll came appreciate thes e pattern able apply problem ﬁrst editio n produce solution think better change second edition syntax w rote ﬁrst edition learned python great programm ing language make great pseudocode language switched th e syntax ﬁrst edition syntax pretty close executab le fact written simulator execute soluti ons book reader familiar python hope ﬁnd m ostly vious case use feature expla syntax mean hope change make book rea dable pagination book peculiar method whitespace puzzle leave space t hint appears sheet paper solution sheet af ter use book class hand page time d student collect binder pagination make possi ble hand problem giving away hint solution somet imes fold staple hint hand problem s tudents decide look hint print bo ok discard blank page work free book mean welcome read copy modify redistribute subject restriction t license hope people ﬁnd book useful hope wil l help continue develop sending correction suggestion ad ditional material thanks allen downey needham ma june primary diﬀerence use indentation indicate tected mutex cause syntax error contributor s list following people contributed t book problem book variation classical problem appeared ﬁrst technical article textboo k know origin problem solution acknowledge text thank student wellesley college worked wit h ﬁrst edition book student olin college work ed second edition won sent small important correction presenta tion tanenbaum s solution dining philosopher problem zingaro punched hole dancer s problem provoked rewrite section hope make s ense daniel pointed error previous version lution problem wrote year later typo hansen typo cigarette smoker problem utten pointed typo including emba rrassing spelling edsger dijkstra johann pointed error solution dini ng savage problem ﬁxed shipman sent passel correction interesting variation barrier problem cass pointed omission discussion dining p hilosophers sciuszkiewicz sent correction ncluding missing line fifo class deﬁnition vaandrager radboud university nijmegen n etherlands student marc schoolderman manuel stampe lars l ockefeer used tool called uppaal check solution book error solution room party problem modus hall problem gorr pointed explanation chapter exactly right arvi helped clarify origin semaphore bartoschek error solution excl usive dance problem typo chapter preface chan error counter kiseliov suggestion improving th e appearance book helped l atex issue espedes working spanish translation o f book typo nahum problem adaptation kenneth reek s tion sushi bar problem o sent correction generalized smoker s problem hawkins pointed unused variable di mare missing elli typo nash typo error solution mal feature pulver problem barbershop soluti preface introduction synchronization execution model serialization message shared variable concurrent writes concurrent update mutual exclusion message semaphore deﬁnition syntax semaphore basic synchronization pattern signaling rendezvous rendezvous hint rendezvous solution deadlock mutex mutual exclusion hint mutual exclusion solution multiplex multiplex solution barrier barrier hint barrier deadlock barrier solution content deadlock reusable barrier reusable barrier reusable barrier problem reusable barrier reusable barrier hint reusable barrier solution preloaded turnstile barrier object queue queue hint queue solution exclusive queue hint exclusive queue solution classical synchronization problem problem hint solution deadlock ﬁnite buﬀer finite buﬀer hint finite buﬀer solution problem hint solution starvation hint solution hint solution mutex mutex hint mutex solution dining philosopher deadlock dining philosopher hint dining philosopher solution dining philosopher s solution tanenbaum s solution starving tanenbaums cigarette smoker problem deadlock smoker problem hint smoker problem solution generalized smoker problem vii generalized smoker problem hint generalized smoker problem solution classical synchronization problem dining savage problem dining savage hint dining savage solution barbershop problem barbershop hint barbershop solution fifo barbershop fifo barbershop hint fifo barbershop solution hilzer s barbershop problem hilzer s barbershop hint hilzer s barbershop solution santa claus problem santa problem hint santa problem solution building h h hint h solution river crossing problem river crossing hint river crossing solution roller coaster problem roller coaster hint roller coaster solution roller coaster problem roller coaster hint roller coaster solution problem problem hint solution unisex bathroom problem unisex bathroom hint unisex bathroom solution unisex bathroom problem unisex bathroom solution baboon crossing problem modus hall problem modus hall problem hint modus hall problem solution content remotely classical problem sushi bar problem sushi bar hint sushi bar sushi bar sushi bar solution sushi bar solution child care problem child care hint child care child care solution extended child care problem extended child care hint extended child care solution room party problem room party hint room party solution senate bus problem bus problem hint bus problem solution bus problem solution faneuil hall problem faneuil hall problem hint faneuil hall problem solution extended faneuil hall problem hint extended faneuil hall problem solution dining hall problem dining hall problem hint dining hall problem solution extended dining hall problem extended dining hall problem hint extended dining hall problem solution synchronization python mutex checker problem mutex checker hint mutex checker solution coke machine problem coke machine hint coke machine solution synchronization c mutual exclusion parent code child code synchronization error ix mutual exclusion hint mutual exclusion solution make semaphore semaphore implementation hint semaphore implementation semaphore implementation cleaning python thread semaphore method creating thread handling keyboard interrupt b cleaning posix thread compiling pthread code creating thread joining thread semaphore contentschapter introduction synchronization common use synchronization mean making thing ha ppen time computer system synchronization little general refers relationship number event nd kind relationship computer programmer concerned synchronization straints requirement pertaining order event e xamples include serialization event happen event mutual exclusion event b happen time real life check enforce synchronization con traints using clock know happened b know tim e event occurred just compare time computer system need satisfy synchronizati constraint beneﬁt clock univ ersal clock don t know ﬁne resolution event occur s book software technique enfo rcing nization constraint execution model order understand software synchronization t o model computer program run simplest model computer execute instruction sequence model synch ronization trivial tell order event looking program st atement come statement b executed introduction way thing complicated possibil ity computer parallel meaning multiple proce ssors running time case easy know statement o ne processor executed statement possibility single processor running mu ltiple thread execution thread sequence instruction execu te sequentially multiple thread processor work e switch general programmer control threa d run operating speciﬁcally scheduler make decision result programmer t tell statement diﬀeren t thread executed purpose synchronization diﬀerence betw een parallel model multithread model issue processor thread know order execution pr ocessors thread impossible tell real world example make clearer imagine yo u friend bob live diﬀerent city day dinne r time start wonder ate lunch ﬁrst day bob ﬁn d obviously ask time ate lunch bu t started lunch clock bob started lunch clock sure started ﬁrst unless ve ry careful accurate clock t computer system face problem clock usually accurate limit precis ion addition time computer doe track time t hings happen just thing happening fast record exact time puzzle assuming bob willing follow simple instru ctions way guarantee tomorrow eat lunch bob serialization message serialization message solution instruct bob eat lunch make sure don t lunch approach trivial underlying idea message passing real solution tion problem risk belaboring obvious consid er timeline thread breakfast lunch bobthread b bob breakfast lunch ﬁrst column list action perform word s thread execution second column bob s thread execution w ithin thread tell order thing happen denote order event relation mean happened general way compare event diﬀ erent thread example idea ate breakfast ﬁrst message passing phone cantell ate lunch ﬁrst assuming bob friend won t combining relation prof lunch bob inthiscase wewouldsaythatyouandbobatelunch sequentially know order event ate breakfast concurrently don t whenwetalkaboutconcurrentevents itistemptingtosayth attheyhappen time simultaneously shorthand s ﬁ ne long remember strict deﬁnition twoeventsareconcurrentifwecannottellbylookingatthep rogram happen ﬁrst tell program run happene d ﬁrst guarantee wil l result introduction concurrent program mean sible tell looking program happen whe n executes simple example program thread yes thread b thread run concurrently order execu tion depends scheduler given run program ou tput yes yes thing make concurrent p rograms hard debug program work correctly time row nd crash run depending particular decision t scheduler kind bug impossible ﬁnd testing t hey avoided careful programming shared variable time variable thread local meaning belong single thread thread access long s true tend synchronization problem thread just don t interact usually variable sharedamong thread way thread interact examp le way communicate information thread threa d read value written thread thread unsynchronized tell loo king program reader value writer writ e old value application enforce c onstraint reader read writer writes thi s exactly serialization problem section way thread interact concurrent writes er concurrent update thread performing read followed write section deal interactio n possible use shared variable concurrent read doe t generally create synchronization problem concurrent writes following example xi shared variable accessed shared variable thread xthread b value xgets printed ﬁnal value xwhen statement executed depends order th e statement executed called execution path possible path case output program ﬁnal value puzzle path yield output ﬁnal value puzzle path yield output ﬁnal value puzzle path yield output ﬁnal value prove answering question like important concu rrent ming path possible possible eﬀect s prove given desirable eﬀect necessary undes irable eﬀect impossible concurrent update update operation read value variable c omputes new value based old value writes new value mo t common kind update increment new value old val ue plus following example show shared variable count updated concurrently thread thread count b count ﬁrst glance obvious synchronizat ion problem execution path yield sult problem operation translated mac hine language execution machine language update take t wo step read write problem obvious rewrite code rary variable temp thread count temp b count temp consider following execution path assuming initial value ﬁnal value boththreadsreadthesameinitialvalue theywritethesame value introduction incremented probably prog rammer mind kind problem subtle possib le tell looking program operation perfo rmed single step interrupted fact computer provid e increment instruction implemented hardware terrupted operation interrupted said atomic write concurrent program don t know operation atomic possibility collect speciﬁc informati tion hardware platform drawback approa ch obvious common alternative make conservative assu mption update writes atomic use synchron ization constraint control concurrent access shared variable common constraint mutual exclusion mutex wh ich tioned section mutual exclusion guarantee onethread access shared variable time eliminating kind synchro nization error section puzzle suppose thread run following program c oncurrently familiar python forloop run update time range temp count count temp largest possible value countafter thread completed smallest possible value hint ﬁrst question easy second mutual exclusion message like serialization mutual exclusion implemented ing message passing example imagine bob operate nuclear react monitor remote station time ar e watching warning light allowed break lu nch doesn t matter eats lunch ﬁrst important d t eat lunch time leaving reactor unwatched puzzle figure message passing phone call enforces restraint assume clock predict lunch start long minimum number message required chapter semaphore real life semaphore signal used communi cate visually usually ﬂags light mechanism softw semaphore data structure useful solving variety synch ronization problem semaphore invented edsger dijkstra famously ecc entric puter scientist detail changed o riginal design basic idea deﬁnition semaphore like integer diﬀerences create semaphore initialize valu e integer butafterthattheonlyoperationsyouareallowedtoperform areincrement increase decrement decrease canno t read current value semaphore thread decrement semaphore result ne gative thread block continue thre ad increment semaphore thread increment semaphore thread ing waiting thread get unblocked tosaythatathreadblocksitself orsimply block istos aythatitnotiﬁes scheduler proceed scheduler pre vent thread running event occurs cause thread becom e unblocked tradition mixed metaphor computer science unblo cking called waking s deﬁnition conse quences deﬁnition want think semaphore general way know thread decrement semaphore block speciﬁc case m ight able prove thread increment semaphore thread s woken thread continue running concurrently way know thread continue immediately youdon tnecessarilyknowwhet heranother thread waiting number unblocked thread z ero finally want think value se maphore mean value positive represents numbe r thread decrement blocking negative present number thread blocked waiting value z ero mean thread waiting thread try decrement block syntax programming environment implementation sem aphores able programming language operating sys tem diﬀerent implementation oﬀer slightly diﬀerent capabil ities usually quire diﬀerent syntax book use simple demonstra te semaphore work syntax creating new semaphore initializing semaphore initialization syntax semaphore function semaphore constructor creates return new semaphore initial value semaphore passed p arameter constructor semaphore operation diﬀerent name diﬀerent en vironments common alternative semaphore operation semaphore operation semaphore semaphore operation surprising name reason increment anddecrement operation used andvandpwere original name proposed dijkstra wisely realized meaningles s better misleading consider pair misleading increment anddecrement neglect mention possibility blocking waking nd semaphore used way signalandwait insist meaningful name suggest semaphore operation don t think world likely embrace na me soon meantime choose arbitrarily use signalandwait semaphore lookingatthedeﬁnitionofsemaphores itisnotatallobvio ful s true don t needsemaphores solve synchronization problem advantage using impose deliberate constraint help progra mmers avoid error using semaphore clean organized m aking easy demonstrate correctness implemented eﬃciently system solution use semaphore portable usually eﬃcient speak dutch vandparen t completely semaphoreschapter basic synchronization pattern chapter present series basic synchronization pro blems show way using semaphore solve problem include se rialization mutual exclusion seen oth er signaling possibly simplest use semaphore signaling mean threadsendsasignaltoanotherthreadtoindicatethatsome thinghashappened signaling make possible guarantee section thread run section code thread w ords solves serialization problem assume semaphore named semwith initial value thread b shared access thread thread b word statement represents arbitrary program statement make example concrete imagine line ﬁle line screen semaphore program guarant ee thread completed thread b begin s work thread b get waitstatement ﬁrst ﬁnd initial value zero block thread signal thread b proceeds similarly thread get signal ﬁrst value o f semaphore incremented thread b get wait wil l proceed basic synchronization pattern mediately way order guaranteed use semaphore basis name signalandwait case name conveniently mnemonic unfortuna tely case name helpful speaking meaningful name semisn t possible good idea semaphore indicates represe nt case like good mean signal mean wait todo write using sync starting doe thread b signal initcomplete rendezvous puzzle generalize signal pattern work w ays thread wait thread b vice versa word given code thread b want guarantee writing solution sure specify name initi al value semaphore little hint solution enforce constraint e xample don t care order solution order possible synchronization problem s rendezvous idea thread rendezvous point execution neit allowed proceed rendezvous rendezvous hint chance good able ﬁgure solution hint create semaphore named aarrived andbarrived initialize zero name suggest aarrived indicates thread arrived rendezvous barrived basic synchronization rendezvous rendezvous solution solution based previous hint thread b working previous problem tried s omething like thread b solution work probably eﬃcie nt switch b time necessary arrives ﬁrst wait b arrives wake proceed immediately waitin case block allowing reach signal thread proceed thinkabouttheotherpossiblepathsthroughthiscodeandco nvinceyourself case thread proceed rrived deadlock working previous problem tried like thread b hope rejected quickly problem suming arrives ﬁrst block wait b arrives block wasn t able signal aarrived point thread proceed situation called deadlock obviously successful solution synchronization problem case e rror obvious possibility deadlock subtle example basic synchronization pattern mutex asecondcommonuseforsemaphoresistoenforcemutualexclu sion ready seen use mutual exclusion controlling concur rent access shared variable mutex guarantee thread access e shared able time mutex like token pass thread allowing thread time proceed example lord fly group child use conch mutex order speak h old conch long child hold conch similarly order thread access shared variable mutex release mutex t hread hold mutex time puzzle add semaphore following example enforce m utual sion shared variable count thread count b count metaphor helpful misleading mutex mutual exclusion hint create semaphore named mutexthat initialized value mean thread proceed access shared variable va lue zero mean wait thread release basic synchronization multiplex mutual exclusion solution solution thread critical section count count thread b critical section count count sincemutexis initially whichever thread get waitﬁrst able proceed immediately course act waiting s emaphore eﬀect decrementing second thread arrive wait ﬁrst signal indented update operation contai ned mutex example thread running code called asymmetric solution thread run diﬀerent code tion isasymmetric symmetric solution easier generalize thi s case mutex solution handle number concurrent thread modiﬁcation long thread wait performin g update signal thread access countconcurrently code need protected called critical section suppose critically important prevent concu rrent access tradition computer science mixed metaphor th ere otherwayspeoplesometimes talkaboutmutexes inthemetap hor wehavebeen using far mutex token passed threa d alternative metaphor think critical section room thread allowed room time taphor mutexes called lock thread said lock mute x entering unlock exiting occasionally people m ix metaphor talk getting releasing lock doesn t make sense metaphor potentially useful potentially misl eading work problem try way thinking lead solution multiplex puzzle generalize previous solution allows m ultiple thread run critical section time enforces n upper limit number concurrent thread word tha nnthreads run critical section time pattern called multiplex real life multiplex problem occurs busy nightclub maximum number people llowed basic synchronization pattern building time maintain ﬁre safety create illusion exclusivity place bouncer usually enforces synchronizati constraint keeping track number people inside barring arri vals room capacity person leaf llowed enter enforcing constraint semaphore sound diﬃcul t barrier multiplex solution allow multiple thread run critical section jus t initialize semaphore n maximum number thread lowed time value semaphore represents number additional thread enter value zero thr ead block thread inside exit signal th read exited value semaphore restored sincethesolutionissymmetric sconventionaltoshowo nlyonecopyofthe code imagine multiple copy code runn ing concurrently multiple thread multiplex solution critical section happens critical section occupied tha n thread arrives course want arrival wai solution doe exactly time arrival join queue s emaphore mented value semaphore negated represe nt number thread queue thread leaf signal semaphore incrementin g value allowing waiting thread proceed thinking metaphor case ﬁnd useful th ink semaphore set token lock thre ad invokes wait pick token invokes signalit release thread hold token enter room token vailable thread arrives wait thread release real life ticket window use like hand token poker chip customer line eac h token allows holder buy ticket barrier consider rendezvous problem section limitation solution presented doe work t wo thread puzzle generalize rendezvous solution thread s hould run following code barrier code basic synchronization pattern thesynchronizationrequirementisthatnothreadexecutes critical point thread executed rendezvous assume nthreads value stored variable n accessible thread ﬁrst thread arrive block nth thread arrives point thread barrier barrier hint problem book provide hint pr esenting variable used solution explaining role barrier hint number thread semaphore semaphore countkeeps track thread arrived mutexprovides sive access countso thread increment safely barrier locked zero negative thread arrive t unlocked basic synchronization barrier barrier present solution quite right becau se useful examine incorrect solution ﬁgure wrong barrier count count count n point sincecountis protected mutex count number thread pas ﬁrst thread wait barrier initiall y locked nth thread arrives unlocks barrier puzzle wrong solution basic synchronization barrier deadlock problem deadlock example imagine thread waiting barrier value semaphore number thread n queue negated oneofthewaitingth readsisallowed proceed semaphore incremented signal semaphore oth er thread pas barrier second example deadlock puzzle doe code create deadlock ﬁnd n execution path code doe notcause deadlock puzzle fix basic synchronization barrier barrier solution finally working barrier barrier solution count count count n point change signalafter waiting barrier thread pass signal semaphore thre ad pas pattern waitand asignalin rapid succession occurs s called turnstile allows thread pas time locked bar thread initial state zero turnstile locked nth thread unlocks nthreads dangerous read value countoutside mutex case problem general probably good idea clean page meantime mi ght want consider question nth thread state turnstile way barrier signaled basic synchronization reusable barrier deadlock thread time pas mutex thread time pas turnstile seen reasonable turnstile inside mutex like bad barrier solution count count count n point turn bad idea cause deadlock imagine ﬁrst thread enters mutex block reach turnstile mutex locked th read enter condition true unlock turnstile case deadlock fairly obvious demonstra te common source deadlock blocking semaphore holding mutex reusable barrier set cooperating thread perform series st eps loop synchronize barrier step applicati need reusable barrier lock thread passed t hrough puzzle rewrite barrier solution th read passed turnstile locked basic synchronization reusable barrier reusable barrier start simple attempt solution nd gradually improve reusable barrier count count n point count count notice code turnstile pretty sa code use mutex protect access shared variablecount tragically code quite correct puzzle problem basic synchronization reusable barrier reusable barrier problem problem spot line previous code thread interrupted point nth thread come mutex thread ﬁnd thread signal turnstile fact possib le thatallthe thread signal turnstile similarly line possible multiple thread wait cause deadlock puzzle fix basic synchronization reusable barrier reusable barrier attempt ﬁxes previous error subtle problem main reusable barrier count count n point count count case check inside mutex thread interrupted changing counter checking tragically code stillnot correct remember barrier inside loop executing line thread rendezvous puzzle identify ﬁx basic synchronization reusable barrier reusable barrier hint currently written code allows precocious thr ead pas second mutex loop pas ﬁrst m utex turnstile eﬀectively getting ahead thread lap solve problem use turnstile reusable barrier hint semaphore semaphore semaphore initially ﬁrst locked second open t thread arrive ﬁrst lock second unlock ﬁrst whe n thread arrive second relock ﬁrst make safe fo r thread loop beginning open basic synchronization reusable barrier reusable barrier solution reusable barrier solution rendezvous count count n lock second unlock turnstile critical point count count lock unlock second second turnstile solution called barrier force thread wait twice thread arrive nd thread execute critical section unfortunately solution typical l synchronization code diﬃcult sure solution correct ofte n subtle way particular path program cause er ror make matter worse testing implementation soluti help error occur rarely particul ar path cause require spectacularly unlucky combination cir cumstances error impossible reproduce debug conve ntional mean alternative examine code carefully pr ove correct prove quotation mark don t mea n necessarily write formal proof zeal ots encourage lunacy kind proof mind informal ad vantage structure code idiom developed assert demonstrate number claim ab program basic synchronization pattern nth thread lock unlock turnstile thread unlock ﬁrst turnstile clo se second vice versa impossible thread g et ahead turnstile ﬁnding right kind statement assert prove y ou time ﬁnd concise way convince skeptical c olleague code reusable barrier preloaded turnstile nice thing turnstile versatile comp onent use variety solution drawback forc e thread sequentially cause context switchi ng necessary reusable barrier solution simplify soluti thread unlocks turnstile preloads turnstile enou gh signal let right number thread syntax using assumes signalcan parameter speciﬁes number signal f eature easy implement loop thing n mind multiple signal atomic signal ing thread interrupted loop case problem reusable barrier solution rendezvous count count n n unlock turnstile critical point count count n unlock second second turnstile nth thread arrives preloads ﬁrst turnstile si gnal thread nth thread pass turnstile take token leaf turnstile locked thing happens second turnstile unlo cked thread go mutex matt tesch solution basic synchronization pattern barrier object natural encapsulate barrier object bor row python syntax deﬁning class barrier class barrier def self n n semaphore semaphore semaphore def self def self def wait self theinitmethod run create new barrier object tializes instance variable parameter ni number thread invoke waitbefore barrier open variable selfrefers object method operating barrier object mutex turnstile refers speciﬁc mutex current object example creates barrier object wait barrier interface barrier n initialize new barrier wait queue optionally code us barrier queue semaphore used represent queue case initial value usually code written possible signal unless thread waiting value semaphore nev er positive example imagine thread represent ballroom dance r kind dancer leader follower wait queue b efore entering dance ﬂoor leader arrives check follower waiting proceed wait similarly follower arrives check leader d proceeds wait accordingly puzzle write code leader follower enforces t hese basic synchronization queue queue hint variable used solution queue hint semaphore semaphore leaderqueue queue leader wait followerqueue queue follower basic synchronization queue queue solution code leader queue solution leader code follower queue solution follower solution simple get just rendez vous leader signal exactly follower follower sign al leader guaranteed leader follower allowed proc eed pair actually proceed pair clear po sible number thread accumulate executing dance possible number leader dancebefore follower depending semantics ofdance behavior problematic tomakethingsmoreinteresting let saddtheadditionalco nstraintthateach leader invoke danceconcurrently follower vice versa word got dance brought puzzle write solution exclusive queue problem lyric performed shania basic synchronization queue exclusive queue hint variable used solution queue hint follower semaphore semaphore semaphore semaphore leader andfollowers counter track number dancer kind waiting mutex guarantee exclusive cess counter leaderqueue andfollowerqueue queue dancer wait rendezvous used check thread basic synchronization queue exclusive queue solution code leader queue solution leader follower follower leader arrives get mutex protects leader follower follower waiting leader decrement follower signal follower invokes dance releasing mutex guarantee follower thread runnin rently follower waiting leader th e mutex waiting leaderqueue code follower similar queue solution follower leader leader follower arrives check waiting leader th ere follower decrement leader signal leader executes dance releasing mutex actually case follower neverreleasesmutex leader doe don t track thread th e mutex know doe releas e solution s basic synchronization pattern semaphore used ﬁnd useful read wait wait queue signal let que ue code signal queue unless waiting value queue semaphore seldom positive possible ﬁgure thep rimarydiﬀerence thread release mutex explicitly waiting nd reacquire explicitly need classical synchronization problem chapter examine classical problem appea r nearly operating system textbook usually presented t erms problem statement problem clear student bring intuition bear forthemostpart theseproblemsdonothappeninthe realworld solution like kin d synchronization code working reason interested problem ar e analogous common problem operating system applica tions need solve classical problem present classic al formulation explain analogy corresponding o problem problem multithreaded program division labor thread common pattern thread producer c onsumers ducers create item kind add data structu consumer remove item process program good example event thing happens requires program respond user press e key move mouse block data arrives disk packet arri f network pending operation completes event occurs producer thread creates event object add event buﬀer concurrently consumer thread t ake event buﬀer process case consumer called event synchronization constraint need enforce make work classical synchronization problem item added removed buﬀer b uﬀer inconsistent state thread excl usive access buﬀer consumer thread arrives buﬀer bloc k producer add new item assume producer perform following operation ove r basic producer code waitforevent event assume consumer perform following operatio n basic consumer code speciﬁed access buﬀer exclusive bu t waitforevent run concurrently puzzle add synchronization statement producer consumer code enforce synchronization problem hint variable want use initialization semaphore semaphore event surprisingly mutexprovides exclusive access buﬀer item positive indicates number item buﬀer wh en negative indicates number consumer thread queue eventis alocal variable context mean thread version far assuming thread access variable ﬁnd useful attach variable thread number way implemented diﬀerent ments thread stack variable allocated stack thread represented object add attribut e thread object thread unique id use id index n array hash table store data program variable local unless declared o therwise book variable shared assume th variable shared unless explicitly declared classical synchronization problem solution producer code solution producer solution waitforevent event producer doesn t exclusive access buﬀe r get event thread run waitforevent concurrently theitemssemaphore keep track number item buﬀer eac h time producer add item signal item incrementing consumer code similar consumer solution event buﬀer operation protected mutex befor e consumer get decrement item ifitemsis zero negative consumer block producer signal solution correct opportunity t o make small improvement performance imagine lea st consumer queue producer signal item scheduler allows consumer run happens immediately block mutex held producer blocking waking moderately expensive operation performing unnecessarily impair performance program probably better rearrange producer like improved producer solution waitforevent event don t bother unblocking consumer know proceed rare case producer beat mutex s thing solution bothe r stickler hint section claimed itemssemaphore keep track classical synchronization problem item queue looking consumer code possibility consumer decrement itemsbefore get mutex remove item buﬀer little itemswould inaccurate try address checking buﬀer inside m utex broken consumer solution event bad idea puzzle problem deadlock consumer running code broken consumer solution event cause deadlock imagine buﬀer sumer arrives get mutex block item producer arrives block onmutexand come grinding halt common error synchronization code time w ait semaphore holding mutex danger deadloc checking solution synchronization problem shoul d check kind deadlock ﬁnite buﬀer example described thread t shared buﬀer usually inﬁnite accurately bounded source like physical memory swap space kernel operating limi t available space buﬀers thing like disk request network pack ets usually ﬁxed size situation like additional synchr onization constraint producer arrives buﬀer block consumer remove item assume know size buﬀer buffersize semaphore keeping track number item tempting write like broken ﬁnite buﬀer solution item buffersize block t remember t check current value o f semaphore operation waitandsignal puzzle write code handle ﬁnit classical synchronization problem finite buﬀer hint add second semaphore track number availabl e space buﬀer initialization semaphore semaphore semaphore whenaconsumerremovesanitemitshouldsignal space whenaproducer arrives decrement space point block consumer classical synchronization problem finite buﬀer solution solution finite buﬀer consumer solution event producer code symmetric way finite buﬀer producer solution waitforevent event order avoid deadlock producer consumer check av ailability fore getting mutex best performance release t mutex signaling problem classical problem called probl em pertains situation data structure database ﬁle read modiﬁed concurrent thread data structure wri tten modiﬁed necessary bar thread reading der prevent reader interrupting modiﬁcation progress read ing inconsistent invalid data problem solution asymme tric reader writer execute diﬀerent code entering criti cal section synchronization constraint number reader critical section simult aneously writer exclusive access critical sectio word writer enter critical section wh ile thread reader writer writer th ere thread classical synchronization problem exclusion pattern called categorical mutual exclusion thread critical section doe necessarily exclud e thread presence category critical section exclude s category puzzle use semaphore enforce constraint allowing reader andwriterstoaccessthedatastructure andavoidingthepo problem hint set variable suﬃcient solve proble initialization reader semaphore semaphore counter reader keep track reader room mutexprotects shared counter roomempty thread reader writer critic al section demonstrates naming conv ention use semaphore indicate condition convention wait usually mean waitfortheconditiontobetrue signal mean signa lthatthecondition true classical synchronization problem solution code writer simple critical section emp ty writer enter entering eﬀect excluding thre ad writer solution critical section writer writer exit sure room yes know thread entered t code reader similar barrier code saw th e previous section track number reader room t hat special assignment ﬁrst arrive leave ﬁrst reader arrives wait roomempty room thenthereaderproceedsand atthesametime barswriters subsequentreaders enter try wait roomempty reader arrives writer room wait s onroomempty hold mutex subsequent reader queue mutex reader solution reader reader lock critical section reader reader reader unlocks code critical section similar read er leave room turn signal roomempty possibly allowing waiting writer enter demonstrate code correct useful assert demonstrate number claim program beh convince following true reader queue waiting roomempty writer queued reader signal roomempty room classical synchronization problem pattern similar reader code common ﬁrst thr ead section lock semaphore queue unl ocks fact common wrap objec pattern lightswitch analogy pattern ﬁrst person room turn light lock mutex turn oﬀ unlocks mutex class deﬁnition lightswitch lightswitch deﬁnition lightswitch def self semaphore def lock self semaphore def unlock self semaphore locktakes parameter semaphore check possi bly hold semaphore locked calling thread block semaphore subsequent thread block semaphore unlocked ﬁrst waiting thread lock waiting thread s proceed semaphore initially unlocked ﬁrst thread lock s quent thread proceed unlockhas eﬀect thread called lockalso call unlock thread call unlock unlocks problem using function rewrite reader code si mply initialization lightswitch semaphore readlightswitch shared lightswitch object counter initially zero solution reader roomempty critical section roomempty code writer unchanged possible store reference roomempty attribute lightswitch pas parameter lockandunlock alternative think improv e readability invocation lockandunlocks speciﬁes semaphore operates starvation intheprevioussolution isthereanydangerofdeadlock orderforadeadlock occur possible thread wait semaphor e holding prevent signaled example deadlock possible rela ted problem bad possible writer starve writer arrives reader critical se ction wait queue forever reader come long new rea der arrives current reader departs al way reader room situation deadlock thread ma king progress exactly desirable program like wor k long load low plenty opp ortunities writer load increase behavior deteriorate quickly point view writer puzzle extend solution writer arrives t existing reader ﬁnish additional reader classical synchronization problem hint sahint youcanaddaturnstileforthereadersandallo wwriterstolockit writer pas turnstile check roomempty semaphore inside turnstile writer ge t stuck turnstile eﬀect forcing reader que ue turnstile reader leaf critical section guaranteed writer enters queued reader s proceed initialization lightswitch semaphore semaphore readswitch keep track reader room lock roomempty ﬁrst reader enters unlocks reade r exit turnstile turnstile reader mutex classical synchronization problem solution writer code writer solution critical section writer writer arrives reader room wil l block line whichmeansthattheturnstilewillbelocked thiswillbarr eadersfromentering writer queued reader code reader solution roomempty critical section reader roomempty reader leaf signal roomempty unblocking waiting writer writer immediately enters critical section waiting reader pas turnstile whenthewriterexitsitsignals turnstile whichunblocksawaitingthread reader writer solution guara ntees writer get proceed possible read er enter writer queued depending application good idea m ore priority writer example writer making l update data structure best minimize number reader s ee old data writer chance proceed general scheduler program mer choose waiting thread unblock scheduler use queue mean thread unblocked order queued scheduler choose random according priority sche based property waiting thread programming environment make possible thread priority simple way address thi s issue ﬁnd way puzzle write solution problem tha t give priority writer writer arrives reader allowed enter writer left classical synchronization problem hint usual hint form variable used solut ion initialization lightswitch lightswitch semaphore semaphore classical synchronization problem solution reader code reader solution nowriters critical section reader nowriters reader critical section hold nowriters doesn t hold noreaders writer arrives lock noreaders cause subsequent reader queue whenthelastreaderexits itsignals nowriters allowinganyqueuedwriters proceed writer code writer solution noreaders critical section writer noreaders writer critical section hold noreaders nowriters relatively obvious eﬀect insuring th ere reader writer critical section addi tion writeswitch obvious eﬀect allowing multiple writer queue nowriters keeping noreaders locked writer pas critical section signaling noreaders writer exit reader enter course drawback solution possib le forreaders starve face long delay applicatio n better obsolete data predictable turnaround classical synchronization mutex mutex previous section addressed ll categorical starvation category thread reader allows ca tegory writer starve atamorebasiclevel wehavetoaddresstheissueof thread starvation possibility thread wait indeﬁnit ely proceed concurrent application starvation unaccepta ble enforce requirement bounded waiting mean time thread wait semaphore matter t o provably ﬁnite starvation responsibility scheduler multiple thread ready run scheduler decides parallel processor set thread get run thread nev er scheduled starve matter semaphore order say starvation start assumption scheduler willing make s trong assumption assume scheduler us algorith m proven enforce bounded waiting don t know al gorithm scheduler us weaker assumption property thread ready run th e scheduler let run assume property build p rovably free starvation example ﬁnite number o f thread program contains barrier starve eventu ally thread waiting barrier point thr ead run general write program free starvation unless make stronger assumption property thread ready run time wait u ntil run bounded discussion far assuming property imp licitly continue hand know ma ny existing system use scheduler guarantee property s trictly starvationrearsitsuglyheadagainwh enweintroduce semaphore deﬁnition semaphore said whe n thread executes signal waiting thread get woken said order say starvation make assumption behavior semaphore weakest assumption make possible avoid starv ation property thread waiting semaphore thread executes signal waiting thread classical synchronization problem requirement obvious trivial h eﬀect barring form problematic behavior threa d signal semaphore thread waiting keep ru nning wait semaphore get signal poss ible prevent starvation property possible avoid starvation bu t thing simple mutex easy example imagin e thread running following code mutex loop true critical section thewhilestatement inﬁnite loop word soon thre ad leaf critical section loop try g et mutex imagine thread get mutex thread b c wait wh en leaf b enters b leaf loop join s c queue b leaf guarantee c go fact go b join queue starting positio n repeat cycle forever c starves existence pattern prof mutex vulner able vation solution problem change impleme ntation semaphore guarantee stronger property property thread waiting semaphore num ber thread woken bounded forexample queue thequeue thenumber ofthreadsahead ﬁnite thread arrive later ahead semaphore property called strong semaphore property called weak semaphore shown weak semaphore simple mutex solution vulnerab le starvation fact dijkstra conjectured possible solv e mutex problem starvation using weak semaphore oblem assuming number thread ﬁnite interested problem section present solution id ea fun just assume semaphore property secti puzzle write solution mutual exclusion problem usi ng weak semaphore solution provide following gua rantee thread arrives attempt enter mutex bou nd number thread proceed ahead assume th e total number thread mutex mutex hint morris s solution similar reusable barrier sect us turnstilestocreatetwowaitingroomsbeforethecriticals ection themechanism work phase ﬁrst phase ﬁrst turnstil e open second closed thread accumulate second room d uring second phase ﬁrst turnstile closed new thread ent er second open existing thread critical secti arbitrary number thread wa iting room guaranteed enter critical section ny future arrival variable used solution changed na me morris used trying make structure clearer mutex hint semaphore semaphore semaphore track thread waiting room mutexhelps protect counter classical synchronization mutex mutex solution morris s solution morris s algorithm critical section beforeenteringthecriticalsection athreadhastopasstw oturnstiles turnstile divide code room room line room room rest speaking loosely counter track number thread room counter protected mutexin usual way guard duty split similarly responsibility exclusive access critical section involves order enter critical section thread hold t exiting give whichever understand solution work start following s ingle thread way get line hold check release mutexand open second turnstile result doesn t wait line safely decrement enter critical section following thread h ave queued leaving critical section ﬁnds release brings starting classical synchronization problem course situation interesting thread inthatcase itispossiblethatwhentheleadthreadgetstol otherthreads entered waiting room queued lead thread leaf instead signal allow following thread enter room locked thread enter room eventually ﬁnite number thread t hread thread enters room case ope allowing thread room thread tha t continues hold lead thread loop block thread leaf room signal allowing thread leave room thread leaf room leaf open brings starting state solution avoids starvation help think operation phase ﬁrst phase thread check room cascade room time way maintain procession thread room becaus e ﬁnite number thread procession end eventuall y point locked second phase thread cascade room ﬁnite number thread room new thread enter tually thread leaf point end ﬁrst phase know thread w aiting end second phase know thread waiting ﬁnite number thread starvation possible f thread loop overtake mechanism make impossible starvation impossible moral story weak semaphore ver y diﬃcult prevent starvation simplest synchronization problem rest book discus starvation assume stro ng dining philosopher dining philosopher dining philosopher problem proposed dijkstra nosaurs ruled earth appears number variation dard feature table ﬁve plate ﬁve fork chop tick big bowl spaghetti philosopher represent intera cting thread come table execute following loop basic philosopher loop true fork represent resource thread hold e xclusively order make progress thing make problem inte resting istic unsanitary philosopher need twoforks eat hungry philosopher wait neighbor assume philosopher local variable ithat identiﬁes philosopher value similarly fork numbered philosopher ihas fork ion right fork left diagram situation assuming philosopher know thinkandeat job write version getforksandputforksthat satisﬁes following straints philosopher hold fork time impossible deadlock occur impossible philosopher starve waiting fork possible philosopher eat classical synchronization problem thelastrequirementisonewayofsayingthatthesolutionsh ouldbeeﬃcient allow maximum concurrency make assumption long eatandthinktake eathas terminate eventually constrai nt philosopher keep fork forever p revent neighbor starving make easy philosopher refer fork ca n use function leftandright fork left return right return operator wrap get enforce exclusive access fork n atural use list semaphore fork initially k available variable dining philosopher semaphore range notation initializing list unfamiliar reader don t use python rangefunction return list element element list python creates semaphore initial value assembles result list named fork initial attempt getforkandputfork dining philosopher fork right fork left fork right fork left s clear solution satisﬁes ﬁrst constraint pretty sure doesn t satisfy did wouldn t interesting problem reading chapter puzzle s wrong dining philosopher deadlock problem table round result philo sopher pick fork wait forever fork deadlock puzzle write solution problem prevents deadl ock hint way avoid deadlock think conditio n make deadlock possible change condition n case deadlock fairly small change break classical synchronization dining philosopher dining philosopher hint philosopher allowed table time d eadlock sible convince claim true write code limit number philosopher classical synchronization dining philosopher dining philosopher solution philosopher table w orst case pick fork fork left table d fork neighbor holding fork theref ore neighbor pick remaining fork eat control number philosopher table m ultiplex namedfootman initialized solution look like dining philosopher solution fork right fork left fork right fork left addition avoiding deadlock solution guaran tee philosopher starves imagine sitting tab le neighbor eating blocked waiting right fork eventually right neighbor eatcan t run forever thread waiting fork necessari ly similar argument starve waiting left fo rk time philosopher spend table bo unded implies wait time room bounded long footman property section solution show controlling number philos ophers avoid deadlock way avoid deadlock change th e order philosopher pick fork original n philosopher righties pick right fork ﬁrst happens philosopher leftie puzzle prove leftie rightie deadlock possible hint deadlock occur philosopher hol ding fork waiting forever c ould fork eat leave proof work contradiction assume deadlo ck possible choose supposedly deadlocked philosopher s leftie prove philosopher lefty contradiction similarly s rightie prove righties way contradiction deadlock possibl classical synchronization dining philosopher dining philosopher s solution asymmetric solution dining philosopher probl em leftie rightie table th case deadlock impossible previous hint outline proof t detail deadlock possible occurs philosop holding fork waiting assume philosop herjis leftie holding left fork waiting righ neighbor right philosopher k holding left fork waiting right neighbor word philosopher kmust leftie repeating argument prove philosoph er lefty contradicts original claim o ne rightie deadlock possible argument used previous solution prov e vation impossible classical synchronization dining philosopher tanenbaum s solution wrong previous solution just completeness let s look alternative best known o ne appears tanenbaum s popular operating system textbook philosopher state variable indicates philoso pher thinking eating waiting eat hungry semaphore ind icates philosopher start eating variable variable tanenbaum s solution thinking semaphore range semaphore initial value stateis list copy thinking list semaphore initial value code tanenbaum s solution state hungry test sem state thinking test right test left test state hungry state left eating state right eating state eating sem thetestfunctioncheckswhetherthe ithphilosophercanstarteating hungry neighbor eating test signal semaphore way philosopher get eat ﬁrst case pher executes getforks ﬁnds fork available proceeds immediately second case neighbor eating phil osopher block semaphore eventually neighbor ﬁ nish point executes teston neighbor possible classical synchronization problem succeed case neighbor run concurrent ly order test doesn t matter order access stateor invoke test thread hold mutex operation checking updating array atomic s ince philosopher proceed know fork available exclu sive access fork guaranteed deadlock possible semaphore ccessed philosopher mutex thread executes waitwhile holding mutex starvation tricky puzzle convince tanenbaum s solutio n prevents vation ﬁnd repeating pattern allows thread star ve thread make dining philosopher starving tanenbaums unfortunately solution ging ra demonstrated repeating pattern allow thread wait fore ver thread come imagine trying starve philosopher initiall y table hungry imagine get s down get sits mirror image t starting position get sits get sits started repeat cycle indeﬁnitely philosopher starve tanenbaum s solution doesn t satisfy requireme classical synchronization cigarette smoker problem cigarette smoker problem cigarette smoker problem problem originally prese nted suhas patil claimed solved semaphore claim come qualiﬁcations case problem inter esting lenging thread involved agent smoker sm okers loop forever ﬁrst waiting ingredient making smok ing cigarette ingredient tobacco paper match assume agent inﬁnite supply ing redients smoker inﬁnite supply ingredient t hat smoker match paper tobacco agent repeatedly chooses diﬀerent ingredient ra ndom make available smoker depending ingredien t chosen smoker complementary ingredient pick bot h resource proceed example agent put tobacco paper smok er match pick ingredient make cigarette nd signal agent explain premise agent represents operating sy stem catesresources andthesmokersrepresentapplicationsth atneedresources problem tomake surethat ifresourcesareavailable w ould allow onemore application proceed application woke n conversely want avoid waking application proceed based premise version probl em appear textbook impossible version patil s version imposes restriction solution youarenotallowedtomodifytheagentcode iftheage ntrepresents operating make sense assume don t w ant modifyiteverytimeanewapplicationcomesalong thesecon drestriction t use conditional statement array se maphores withtheseconstraints theproblemcannotbesolved butas parnaspoints second restriction pretty artiﬁcial constraint like lot problem unsolvable interesting version version keep ﬁrst t change agent drop trivial version textbook problem speciﬁes agent signal smoker according th e ingredient available version problem uninteres ting make premise ingredient cigarett e irrelevant practical matter probably good idea r equire agent know thread waitin g finally version problem just classical synchronization problem naturally focus interesting version comp lete ment problem need specify agent code age nt us following semaphore agent semaphore semaphore semaphore semaphore semaphore agent actually concurrent thread ag ent agent b agent wait agentsem time agentsem signaled agent wake provides ingredient signaling semaphore agent code agent b code agent c code problem hard natural solution doe wo rk tempting write like smoker match smoker tobacco cigarette smoker problem smoker paper s wrong solution classical synchronization cigarette smoker problem deadlock problem previous solution possibility deadlock imagine agent put tobacco paper smoker wi th match waiting tobacco unblocked smoker tobacco waiting paper possible likely unblocke ﬁrst thread block paperand second block match deadlock classical synchronization cigarette smoker problem smoker problem hint solution proposed parnas us helper thread ca lled pusher respond signal agent track avail able ingredient signal appropriate smoker additional variable semaphore smoker problem hint ispaper ismatch false semaphore semaphore semaphore boolean variable indicate ingredient table pusher use tobaccosem signal smoker tobacco semaphore classical synchronization cigarette smoker problem smoker problem solution code pusher pusher ispaper ispaper false elif ismatch ismatch false istobacco true pusher wake time tobacco table ﬁnds ispaper true know pusher b run signal t smoker match similarly ﬁnds match tabl e signal smoker paper pusher run ﬁrst ﬁnd ispaper andismatch false signal smoker set istobacco pusher similar pusher al work smoker code trivial smoker tobacco parnas present similar solution assembles boole variable wise integer us integer index array semaphore way avoid using conditionals artiﬁcial constraint resulting code bit concise t function obvious generalized smoker problem parnas suggested smoker problem diﬃc ult modify agent eliminating requirement agent wait fter putting ingredient case multiple instance s ingredient table puzzle modify previous solution deal varia classical synchronization cigarette smoker problem generalized smoker problem hint agent don t wait smoker ingredient ccumulate table instead using boolean value track ingre dients need integer count generalized smoker problem hint numpaper nummatch classical synchronization cigarette smoker problem generalized smoker problem solution modiﬁed code pusher pusher numpaper numpaper elif nummatch nummatch numtobacco way visualize problem imagine ag ent run creates pusher give ingredient d put room pusher mutex pu ﬁle room sleeping smoker table time pusher enters room check ingredient table assemble complete set ingredient take oﬀ t able wake corresponding smoker leaf ingredient th e table leaf waking example pattern time whic h scoreboard variable numpaper numtobacco andnummatch track state thread ﬁles mutex check state looking scoreboard reacts accordingl classical synchronization problemschapter classical synchronization problem dining savage problem problem andrew s concurrent programming tribe savage eats communal dinner large pot hold m serving stewed savage want eat help pot unless p ot savage wake cook wait ok reﬁlled pot number savage thread run following code unsynchronized savage code true getservingfrompot eat cook thread run code unsynchronized cook code true putservingsinpot m problem based cartoonish representation history west ern sionaries society humor intended allusion dining philosopher problem representation savage sn t intended realistic previous representation philosopher f interested society recommend jared diamond s gun germ steel napoleon chagnon s yanomamo redmond o hanlon s trouble tierney s darkness el dorado believe classical synchronization problem synchronization constraint invoke getservingfrompot pot cook invoke putservingsinpot pot puzzle add code savage cook satisﬁes th e nization dining savage problem dining savage hint tempting use semaphore track number serving problem order signal cook pot thread know decrementing semaphore wait just t alternative use scoreboard track numb er serving savage ﬁnds counter zero wake cook wait s signal pot variable used dining savage hint semaphore semaphore semaphore surprisingly emptypot indicates pot fullpot indicates pot classical synchronization dining savage problem dining savage solution solution combination scoreboard pattern rendezvous code cook dining savage solution cook true putservingsinpot m code savage little complicated savage pass mutex check pot signal cook wait decrement serving get serving pot dining savage solution savage true serving serving m serving getservingfrompot eat odd savage cook set serving s really necessary cook run putservingsinpot know savage hold mutex waiting fullpot cook accessservings safely case decided let savage clear looking code access serving inside mutex solution opportunity adlock come savage hold mutexwaits fullpot waiting savage queued mutex eventually cook run signal fullpot allows waiting savage resume release mu tex doe solution assume pot doe s guarantee thatputservingsinpot andgetservingfrompot executed exclusively classical synchronization barbershop problem barbershop problem original barbershop problem proposed dijkstra variation appears silberschatz galvin s operating system concept barbershop consists waiting room nchairs barber room containing barber chair cust omers served barber go sleep customer enters th e barbershop chair occupied customer le aves shop barber busy chair available n customer sits free chair barber aslee p customer wake barber write program coordinate t barber customer make problem little concrete added follow ing tion thread invoke function named gethaircut customer thread arrives shop invo kebalk doe return barber thread invoke cuthair barber invokes cuthair exactly thread invoking gethaircut concurrently write solution guarantee classical synchronization barbershop problem barbershop hint barbershop hint semaphore semaphore semaphore semaphore semaphore ni total number customer shop waiting room chair customer count number customer shop protected mutex barber wait customer customer enters shop customer wait barberuntil barber signal seat haircut customer signal customerdone wait barberdone classical synchronization barbershop problem barbershop solution solution combine scoreboard code customer barbershop solution customer customer n balk customer gethaircut customer ncustomers shop customer arrive immediately invokebalk customer signal customer wait barber code barber barbershop solution barber cuthair time customer signal barber wake signal barber give hair cut customer arrives barber busy iteration barber pas customer semaphore sleeping name customer andbarberare based naming convention arendezvous mean waitforacustomer customer wait plural rendezvous rare dictionary agree abou t possibility plural spelled rendezvous ﬁna l s classical synchronization problem second rendezvous using customerdone andbarberdone ensures hair cut barber loop let n ext customer critical section solution fifo barbershop fifo barbershop previous solution guarantee customer s served order arrive ncustomers pas turnstile signal customer wait barber barber signal barber customer proceed modify solution customer served orde r pas turnstile hint refer current thread self write semaphore thread get classical synchronization fifo barbershop fifo barbershop hint solution us list semaphore named queue fifo barbershop hint semaphore semaphore semaphore semaphore thread pass turnstile creates thread p ut queue insteadofwaitingon barber eachthreadwaitsonitsownsemaphore barber wake remove thread queue sig nals classical synchronization fifo barbershop fifo barbershop solution modiﬁed code customer fifo barbershop solution customer semaphore customer n balk customer gethaircut customer code barber fifo barbershop solution barber sem cuthair notice barber mutexto access queue solution classical synchronization hilzer s barbershop problem hilzer s barbershop problem william stalling present complicated version barbershop problem attribute ralph hilzer californ ia state university chico barbershop chair barber waitin g area accommodate customer sofa ha s standing room additional customer code limit th e total number customer shop customer enter shop ﬁlled capacity wi th customer inside customer take seat th e sofa stand sofa ﬁlled barber free custo mer sofa longest served ar e standing customer shop long est take seat sofa customer s haircut ﬁnished barber accept payment c ash register payment accepted customer time bers divide time cutting hair accepting paymen t sleeping chair waiting customer word following synchronization constraint apply entershop sitonsofa gethaircut pay invoke cuthair andacceptpayment invoke entershop shop capacity sofa arriving customer invoke sitonsofa customer invokes gethaircut corresponding barber executing cuthair concurrently vice versa possible customer execute gethaircut concurrently barber execute cuthair concurrently customer paybefore barber acceptpayment barber acceptpayment customer exit puzzle write code enforces synchronization const raints hilzer s classical synchronization problem hilzer s barbershop hint variable used solution hilzer s barbershop hint semaphore semaphore semaphore semaphore semaphore semaphore semaphore mutexprotectscustomers keep track number customer shop list semaphore thread waiting seat sofa list semaphore thread waiting chair sofais multiplex enforces maximum number customer sofa signalsthatthereisacustomerin signal customer payment signalsthatacustomerhaspaid receipt sigmalsthatabarber accepted hilzer s barbershop problem hilzer s barbershop solution solution considerably complex expected hilzer simpler mind best hilzer s barbershop solution customer semaphore semaphore customer n balk customer entershop sitonsofa sitinbarberchair pay customer theﬁrstparagraphisthesameasintheprevioussolution wh enacustomer arrives check counter balk add itsel f queue signal barber customer get queue enters multiplex sits couch add second queue get thatqueue get haircut pay classical synchronization problem hilzer s barbershop solution barber sem sem cuthair acceptpayment barber wait customer enter signal custom er s semaphore queue wait claim seat fa enforces fifo requirement barber wait customer join second queue signal allowing customer claim chair barber admits customer chair u p concurrent haircut cash registe r customer getmutex customer barber rendezvous cash register th en exit solution satisﬁes synchonization constraint bu t leaf sofa underutilized barber customer sofa multiplex unneces sary solution way think solve problem create t hird kind thread usher usher manage barber usher barber sofa fully utilized solution santa claus problem santa claus problem problem william stalling s operating system tribute john trono michael s college vermont stand claus sleep shop north pole awakened reindeer thei r tion south paciﬁc elf having diﬃcu lty making toy allow santa sleep elf ly wake problem elf ar e having problem solved elf wishing vi santa wait elf return santa wake ﬁnd th ree elf waiting shop s door reindee r having come tropic santa decided elf c wait christmas important g et sleigh ready assumed reindeer want l eave tropic stay po sible ment reindeer arrive santa ot wait warming hut harnessed sleigh addition speciﬁcations ninth reindeer arrives santa invoke preparesleigh reindeer invoke gethitched elf arrives santa invoke helpelves concurrently elf invoke gethelp elf invoke gethelp additional elf enter increment elf counter santa run loop help set elf c assume exactly reindeer number classical synchronization santa claus problem santa problem hint santa problem hint semaphore semaphore semaphore semaphore elvesandreindeer counter protected mutex elf reindeer mutexto modify counter santa get check santa wait santasem elf reindeer signal reindeer wait reindeersem santa signal enter paddock hitched elf use elftexto prevent additional elf entering elf classical synchronization santa claus problem santa problem solution santa s code pretty straightforward remember ru n loop santa problem solution santa reindeer preparesleigh reindeer elf helpelves santa wake check condition hol d deal reindeer waiting elf reindeer waiting santa invokes preparesleigh signal reindeersem time allowing reindeer invoke gethitched elf waiting santa just invokes helpelves need elf wait santa signal santasem invoke gethelp immediately santa doesn t decrement elvescounter elf way code reindeer santa problem solution reindeer reindeer reindeer ninth reindeer signal santa join rei ndeer waiting onreindeersem santa signal reindeer execute gethitched elf code similar elf arrive s bar subsequent arrival ﬁrst executed classical synchronization problem santa problem solution elf elf elf elf elf ﬁrst elf release elftexat time release mutex elf hold elftex barring elf entering elf invoked gethelp elf leave release elftex allowing batch elf building h building h problem staple operating system class ley decade based exercise andrew s concurrent programming kind thread oxygen hydrogen order assemble thread water molecule create barri er make thread wait complete molecule ready proceed aseachthreadpassesthebarrier itshouldinvoke bond youmustguarantee thread molecule invoke bondbefore thread molecule word oxygen thread arrives barrier hydrogen th read present wait hydrogen thread hydrogen thread arrives barrier thre ad present wait oxygen thread hydro gen thread don t worry matching thread explicit ly thread necessarily know thread paired key just thread pas barrier complet e set examine sequence thread invoke bondand divide group group contain oxygen hydrog en thread puzzle write synchronization code oxygen hydrogen molecule enforces classical synchronization building h h hint variable used solution water building hint semaphore barrier semaphore semaphore oxygenandhydrogen counter protected set thread meet invoking bondand allowing set thread proceed oxyqueue semaphore oxygen thread wait hydroqueue semaphore hydrogen thread wait using naming tion queue mean join oxygen queue mean release oxygen thread classical synchronization building h h solution initiallyhydroqueue andoxyqueue locked oxygen thread arrives signal hydroqueue twice allowing hydrogen proceed oxygen thread wait hydrogen thread arrive oxygen code hydrogen hydrogen oxygen oxygen thread enters get mutex check scoreboard hydrogen thread waiting signal s bond release mutex wait bonding thread wait barrier th read bonded oxygen thread release mutex oxygen thread set guaranteed si gnalmutexonce code hydrogen similar hydrogen code hydrogen oxygen hydrogen oxygen classical synchronization problem unusual feature solution exit point t mutex ambiguous case thread enter mutex update th e counter exit mutex thread arrives form complet e set mutex order bar subsequent thread cu rrent set invokedbond invoking bond thread wait barrier barrier open know thread invoked bondand hold mutex don t know whichthread hold mutex doesn t matter long release know th ere oxygen thread make work wrong generally bee n true thread hold lock order release rule say true case mi sleading think mutex token thread acquire release river crossing problem problem set written anthony joseph rkeley don t know original author similar h problem sense peculiar sort barrier allow s thread pas certain combination near redmond washington rowboat s used linux hacker microsoft employee serf cross river ferry hold exactly people won t leave shore mo fewer guarantee safety passenger permissibl e hacker boat serf serf hack er combination safe aseachthreadboardstheboatitshouldinvokeafunctioncal ledboard guarantee thread boatload invo keboardbefore thread boatload thread invoked board exactly function named rowboat indicating thread oar doesn t matter thread call function long e doe don t worry direction travel assume interested traﬃc going river crossing problem river crossing hint variable used solution river crossing hint barrier semaphore semaphore semaphore iscaptain false hacker andserfscount number hacker serf waiting board protected mutex check condition variable worrying untimely update s example scoreboard hackerqueue andserfqueue allow control number hacker serf pas barrier make sure thread invoked board captain invokes rowboat iscaptain local variable indicates thread invok classical synchronization river crossing problem river crossing solution basic idea solution arrival update o ne counter check make complement fourth kind completing mixed pair pair llpresentthecodeforhackers theserfcodeissymmetric ofcourse time bigger bug contains e mbedded web browser river crossing solution hacker hacker hacker iscaptain true elif hacker serf serf hacker iscaptain true captain keep mutex iscaptain rowboat captain release mutex thread ﬁles mutual exclusion section check complete crew ready board signal approp riate thread declares captain hold mutex order bar dditional thread boat sailed barrier keep track thread boarded whe n thread arrives thread proceed captain invoked rowand ﬁnally release classical synchronization roller coaster problem roller coaster problem problem andrew s concurrent programming attribute herman s master s thesis suppose npassenger thread car thread passenger repeatedly wait ride car ca n hold cpassengers c car track additional detail invoke boardandunboard car invoke load runandunload board car invoked load car depart cpassengers boarded unboard car invoked unload puzzle writecodeforthepassengersandcarthatenforcest classical synchronization roller coaster problem roller coaster hint roller coaster hint semaphore semaphore semaphore semaphore semaphore semaphore mutexprotects passenger count number passenger invoked boardcar passenger wait boardqueue boarding unboardqueue unboarding allaboard indicates car classical synchronization roller coaster problem roller coaster solution code car thread roller coaster solution car c c car arrives signal cpassengers wait signalallaboard departs allows cpassengers disembark wait allashore roller coaster solution passenger boarder c boarder unboarders c unboarders passenger wait car boarding naturally wait car stop leaving passenger board signal t car reset passenger classical synchronization roller coaster problem roller coaster problem solution doe generalize case m ore car order satisfy additional constr aints car boarding time car track concurrently car t pas unload sa order boarded thread carload disembark thread subsequent carload puzzle modify previous solution handle addition al constraint assume mcars car local variable namedithat contains identiﬁer classical synchronization roller coaster problem roller coaster hint used list semaphore car order present loading area represents unloading area li t contains semaphoreforeachcar atanytime onlyonesemaphoreineac hlistisunlocked enforces order thread load unload initi ally aseachcarenterstheload ing orunloading wait semaphore leaf signal car line roller coaster hint semaphore range m semaphore range m function nextcomputes identiﬁer car sequence wrapping implementation return classical synchronization roller coaster problem roller coaster solution modiﬁed code car roller coaster solution car c c code passenger classical synchronization problemschapter problem problem andrew s concurrent programming kind thread share access list searcher inserters deleters searcher merely exami ne list execute concurrently insert er add new item end list insertion mutually e clusive preclude inserters inserting new item t time insert proceed parallel wi th number search finally deleters remove item list deleter process access l ist time deletion mutually exclusive sea rches insertion puzzle write code searcher inserters deleters th enforces kind categorical mutual problem hint hint semaphore semaphore semaphore lightswitch lightswitch insertmutex ensures inserter critical section time nosearcher andnoinserter indicate surprise searcher inserters critical section deleter need h old enter searchswitch andinsertswitch used searcher inserters exclude problem solution solution solution searcher nosearcher critical section nosearcher theonlythingasearcherneedstoworryaboutisadeleter th eﬁrstsearcher takesnosearcher release solution inserter noinserter critical section noinserter similarly ﬁrst inserter take noinserter release searcher inserters compete diﬀerent sema phores critical section concurrently insertmutex ensures inserter room time solution deleter critical section deleter hold nosearcher andnoinserter guaranteed exclusive access course time thread holding semaphore need check deadlock trying scenario able convince solution dea dlock free hand like categorical exclusion problem prone starvation saw proble m time mitigate problem giving priority catego ry thread cording criterion general diﬃcult write eﬃcient solution allows maximum degree ncurrency avoids problem unisex bathroom problem wrote friend left position teaching physic colby college took job xerox working cubicle basement concrete mono lith nearest woman s bathroom ﬂoors proposed t o uberboss convert men s bathroom ﬂoor unisex ba throom sort like ally mcbeal uberboss agreed provided following synchroni zation straints maintained men woman bathroom time employee squandering company time bathroom course solution avoid deadlock thoug h don t worry starvation assume bathroom equipp ed semaphore need learned nearly identical problem appears andrew s concurrent programming unisex bathroom problem unisex bathroom hint variable used solution unisex bathroom hint semaphore lightswitch lightswitch semaphore semaphore emptyis room maleswitch allows men bar woman room ﬁrst male enters lightswitch lock barring woman male unlocks allowing woman enter woman likewise using femaleswitch malemultiplex andfemalemultiplex ensure men woman unisex bathroom problem unisex bathroom solution female code unisex bathroom solution female bathroom code male code similar problem solution unisex bathroom problem unisex bathroom problem problem previous solution allows star vation long line woman arrive enter man waiting vice versa puzzle ﬁx baboon crossing problem unisex bathroom solution seen use turnstile allow kind thread stop ﬂow kind thread time ll look t male code unisex bathroom solution male bathroom code long men room new arrival pas thr ough turnstile enter woman room male arrives male block inside turnstile bar late r arrival male female entering current occupant leave point male turnstile enters possibly allowing additional male s enter female code similar men room ar riving female stuck turnstile barring additional men solution eﬃcient busy t thread male female queued turn stile time emptyis signaled thread leave turnstile enter new thread opposite gender promptly block barring additional thread usually thread b athroom time advantage available c oncurrency baboon crossing problem problem adapted tanenbaum s operating system design implementation deep canyon kruger national park south africa single rope span canyon b aboons cross canyon swinging rope baboon going opposite direction meet middle ﬁght dr op death furthermore rope strong hold baboon baboon rope time break assuming teach baboon use semaphore w ould like design synchronization scheme following prope rties baboon begun cross guaranteed running baboon going way baboon problem continuing stream baboon crossing direction sho uld bar baboon going way indeﬁnitely starvation include solution problem reason clear modus hall problem problem written nathan karst olin stud ents living modus winter particularly heavy snowfall winter denize n tytown rest campus day resident walk class food civilization path ignore indolent student chose daily drive tier wi ll ignore direction pedestrian traveling fo r known reason student living west hall occasional ly ﬁnd necessary venture mod unfortunately path wide allow peopl e walk mod person meet point t path gladly step aside neck high drift ac modate similar situation occur resha ll inhabitant cross path mod heathen reshall prud e meet violent skirmish ensue victor s mined solely strength number faction wit h larger population force wait similar baboon crossing problem way t han withtheaddedtwistthatcontrolofthecriticalsectionisd eterminedbymajority rule potential eﬃcient free solution categorical exclusion problem starvation avoided faction control th e critical section member faction accumulate queue chieve majority bar new opponent entering wait critical section clear expect solution eﬃcient becaus e tend thread batch allowing maximum concurre ncy critical section puzzle write code implement categorical exclusion w ith majority rule hall nickname modular building ka mod student lived second residence hall modus hall problem modus hall problem hint variable used solution modus problem hint neutral semaphore semaphore semaphore semaphore semaphore heathen andprudesare counter statusrecords status ﬁeld neutral heathen rule prude rule transition then transition prude protected mutexin usual scoreboard pattern heathenturn andprudeturn control access ﬁeld bar transition heathenqueue andprudequeue thread wait checking taking modus hall problem modus hall problem solution code heathen modus problem solution status neutral status heathen rule status prude rule heathen prude status transition heathen status transition heathen cross field heathen status transition prude prude prude status prude rule status neutral status heathen rule prude heathen status transition prude problem student check consider following ca s ﬁeld student lay claim heathen heathen currently charge new arrival t ipped balance lock prude turnstile switche s transition mode prude charge new arrival doesn t tip ba lance join queue transitioning heathen control new ar rival join queue conclude heathen charge tem transitioning prude control case t hread proceed similarly student check consider se veral case heathen check consider following transition mean prude turn stile locked open prude waiting signal update statusso prude charge new status neutral heathen check che ck possibility departure tip balance case close heathen turnstile start transition potential diﬃculty solution number thread interrupted line passed turnstile checked check counted b alance power reﬂect number thread passed turn stile transition end thread checked ha ve checked point thread type h ave passed turnstile thesebehaviors aﬀect solution doe gu arantee imum don t aﬀect correctness ac cept jority rule applies thread registered remotely classical problem sushi bar problem problem inspired problem proposed kenneth ek imagine sushi bar seat arrive s eat seat immediately arrive seat mean dining wait t entire party leave sit puzzle write code customer entering leaving su shi bar enforces remotely classical sushi bar problem sushi bar hint variable used sushi bar hint waiting semaphore semaphore false eatingandwaiting track number thread sitting bar waiting mutexprotects counter mustwaitindicates bar som incoming customer block remotely classical sushi bar problem sushi bar incorrect solution reek us illustrate t diﬃculties problem sushi bar waiting reacquire mutex waiting eating eat sushi eating n min waiting n false puzzle s wrong solution remotely classical sushi bar problem sushi bar problem line customer arrives bar mutex wait customer le customer leaf signal block wake waiting customer clear mustwait customer wake mutex mean compete incoming new thread new t hreads arrive mutex ﬁrst seat th e waiting thread just question injustice possible mo thread critical section concurrently violates t synchronization constraint reek provides solution problem appear section puzzle come diﬀerent correct solut ion hint solution us additional remotely classical sushi bar problem sushi bar solution reason waiting customer reacquire mutex update state ofeatingandwaiting way solve problem make departing customer mutex updati ng sushi bar solution waiting eating eating eat sushi eating n min waiting waiting n eating n eating n departing customer release mutex eatinghas updated newly arriving customer right stat e block necessary reek call pattern ll beca use departing thread doing work logically belong w aiting thread drawback approach little diﬃcult conﬁrm state updated remotely classical sushi bar problem sushi bar solution reek s alternative solution based counterintuiti ve notion transfer mutex thread word o ne thread acquire lock thread release long thread understand lock transferred noth ing wrong sushi bar solution waiting resume mutex waiting eating waiting pas mutex eat sushi eating false waiting pas mutex g anentering customer just increment eatingand release mutex ﬁfth customer setsmustwait ifmustwaitis set entering customer block customer t bar clear mustwaitand signal block understood signaling thread give mutex waiting thread receives mind invariant understood programm er mented comment enforced semantics s emaphores right waiting thread resume understand th e mutex thread waiting signal blockwhich pass mutex waiting thread process continues threa d passing mutex chair waiting th read case thread release mutex go sit remotely classical problem reek call pattern pas baton mutex b eing passed thread like baton relay race nic e thing solution easy conﬁrm update eatingandwaiting consistent drawback harder conﬁrm mutex used correctly child care problem max hailperin wrote problem textbook operating system dleware child care center state regulation require adult present child puzzle write code child thread adult thread e nforces constraint critical child care problem child care hint hailperin suggests almostsolve problem semaphore child care hint semaphore multiplex count number token available token allo w child thread enter adult enter signal multiplex time leave waitthree time problem solution puzzle problem remotely classical child care problem child care adult code look like hailperin s ution child care adult critical section problem potential deadlock imagine t hree child adult child care center value multiplex adult able leave adult start leav e time divide available token bot h block puzzle solve problem minimal remotely classical child care problem child care solution adding mutex solves problem child care solution adult critical section nowthethree waitoperationsareatomic iftherearethreetokensavailable thread get mutex token ex fewer token available ﬁrst thread block mut ex subsequent thread queue mutex extended child care problem feature solution adult thread waiting t o leave prevent child thread entering sothevalue ofthemultiplex adult try leave toke n block waiting child thread arrives wait legal enter point view adult trying leave just ﬁne trying maximize utilization child care center s puzzle write solution problem avoids unneces sary waiting hint think dancer section remotely classical child care problem extended child care hint variable used solution extended child care hint adult waiting leaving semaphore semaphore semaphore child adult waiting andleaving track number dren adult child waiting enter adult waiting leave protected mutex child wait childqueue enter necessary adult wait adultqueue remotely classical child care problem extended child care solution solution complicated hailperin s elegant solution acombination ofpatterns wehave seenbefore ascore board twoqueues ll child code extended child care solution child child adult critical section child leaving child leaving adult child enter check adult s increment child enter increment waiting block exit check adult thread waiting leave sign al remotely classical problem code adult extended child care solution adult waiting n min waiting n waiting n child n critical section child adult adult enter signal waiting child befor e leave check adult left decre mentadultsand exit increment leaving block adult thread waiting leave count adult criti cal section additional child room party problem room party problem wrote problem colby college semeste r controversy allegation student fr om dean student oﬃce searched room absence allegation public dean student wasn t able comment case really happened wrote problem tease friend dean student housing following synchronization constraint apply studen t dean student number student room time dean student enter room stu dent room conduct search stud ents room break party dean student room additional stu dent enter student leave dean student leave room studen t left thereisonlyonedeanofstudents soyoudonothavetoenfo rceexclusion multiple dean puzzle write synchronization code student dean student enforces remotely classical room party problem room party hint room party hint semaphore semaphore semaphore semaphore student count number student room deanis state dean waiting room mutexprotects student anddean example scoreboard turnis turnstile keep student entering room clearandlieinare used rendezvous student dean kind scandal remotely classical room party problem room party solution problem hard worked lot version befor e got version appeared ﬁrst edition correct occasionally dean enter room ﬁnd h e search break party skulk oﬀ em barrassed silence matt tesch wrote solution spared humiliation bu t result complicated hard time convincing oursel f correct solution led bit mo readable room party solution dean student student dean waiting mutex student student student dean room breakup lock turnstile mutex student unlock turnstile student search dean arrives case stu dent room dean wait dean break party wait student leave f student dean search leaf ﬁrst case dean wait rendezvous wit h student mutexto avoid deadlock dean wake modify scoreboard need mutex similar situation saw sushi bar problem solution chose pas baton remotely classical problem room party solution student dean room student student dean waiting pas mutex dean student student dean waiting pas mutex dean elif student dean room pas mutex dean case student signal dean dean waiting student ou t signal liein dean room waiting student lea ve student signal clear case understood mutex pass student dean solution obvious know dean s code student key realize way point ei ther ﬁrst conditional false mean student dean waiting lieinwhen student signaled mean student senate bus problem senate bus problem thisproblemwasoriginallybasedonthesenatebusatwelles leycollege rider come bus stop wait bus bus arrives t waiting rider invoke boardbus arrives bus boarding wait bus capacity bus people f people waiting wait bus waiting rider boarded bus invoke depart bus arrives rider depart immedi ately puzzle write synchronization code enforces se remotely classical senate bus problem bus problem hint variable used solution bus problem hint semaphore semaphore semaphore semaphore mutexprotectsriders keep track rider waiting multiplex make sure rider boarding rider wait bus get signaled bus arrives bus wait onallaboard get signaled student remotely classical senate bus problem bus problem solution code bus using pas b aton pattern bus problem solution bus rider pas mutex mutex bus arrives get mutex prevents late arrival ing boarding area rider departs imme diately signal busand wait rider board code rider bus problem solution rider rider mutex rider pas mutex multiplex control number rider waiting ar ea strictly speaking rider doesn t enter waiting area til increment rider rider wait busuntil bus arrives rider wake understood mutex boarding ride r decrement rider rider waiting boarding rider signal sbusand pas mutex rider rider signal allaboard pass mutex bus finally bus release mutex departs puzzle ﬁnd solution problem using ll pattern remotely classical senate bus problem bus problem solution grant hutchins came solution us fewer v ariables previous doesn t involve passing mutexe variable bus problem solution initialization new semaphore new semaphore new semaphore waiting number rider boarding area protect ed bus arrived boarded signal rider boarded code bus bus problem solution bus min waiting range n max bus get mutexand hold boarding process loop signal rider turn wait board c ontrolling number signal bus prevents rider b oarding rider boarded bus update waiting example ll pattern code rider us simple pattern mutex rendezvous bus problem solution rider waiting challenge rider arrive bus boarding m ight annoyed make wait ﬁnd solution th allows late arrival board violating constrai nt remotely classical faneuil hall problem faneuil hall problem problem written grant hutchins inspired friend took oath citizenship faneuil hall boston kind thread immigrant spectator judge immigrant wait line check sit s ome point judge enters building judge building enter immigrant leave spectator leave immigrant check judge conﬁrm naturalization conﬁrmation immigrant pick certiﬁcates citizenship t judge leaf point conﬁrmation spectator enter s immigrant certiﬁcates make requirement speciﬁc let s thre ad tions execute constraint function invoke enter checkin sitdown swear getcertificate andleave judge invokes enter confirm andleave invoke enter spectate andleave judge building enterand immigrant notleave judge confirm immigrant invoked enter invoked checkin getcertificate judge executed remotely classical faneuil hall problem faneuil hall problem hint faneuil hall problem hint semaphore semaphore semaphore nojudge act turnstile incoming immigrant spectator protectsentered whichcountsthenumberofimmigrantsintheroom checked count number immigrant checked pro tected mutex confirmed signal judge executed remotely classical faneuil hall problem faneuil hall problem solution code immigrant faneuil hall problem solution immigrant judge entered checked pas mutex immigrant pas turnstile enter t judge room turnstile locked entering immigrant mutexto check update checked judge waiting immigrant check si gnals allsignedin pass mutex judge code judge faneuil hall problem solution judge entered checked remotely classical problem mutex checked checked judge hold nojudge bar immigrant spectator entering andmutexso access entered andchecked judge arrives instant enter ed checked proceed immediately mutex wait immigrant check signal allsignedin understood judge mutex invoking confirm judge signal confirmed grant checked reset counter exa mple ll judge leaf release mutexandnojudge judge signal confirmed immigrant invoke swearand getcertificate concurrently wait nojudge turnstile open leaving code spectator easy constraint hav e obey nojudge turnstile faneuil hall problem solution spectator note solution possible immigrant st uck certiﬁcate judge coming swear batch immigrant happens wait swearing puzzle modify solution handle additional const raint judge leaf immigrant sworn l eave judge enter faneuil hall problem extended faneuil hall problem hint solution us following additional variable faneuil hall problem hint semaphore semaphore extended problem involves additional rendezvo solve semaphore hint useful use pas baton pa ttern remotely classical faneuil hall problem extended faneuil hall problem solution half solution diﬀere nce start immigrant wait judge leave faneuil hall problem solution immigrant judge entered checked pas mutex mutex checked pas mutex pas mutex judge diﬀerence start line judge ready leave t release nojudge allow immigrant possibly judge enter instead signal exit allows immigrant leave pass mutex immigrant get signal decrement checked pass baton immigrant immigrant leave sign alsallgone pass mutex judge stri ctly necessary nice feature judge release mutexandnojudge end phase remotely classical problem faneuil hall problem solution judge entered checked mutex checked pas mutex spectator code extended problem dining hall problem dining hall problem problem written jon pollack synchroniz ation class olin college student dining hall invoke dineand leave invoking dine invoking leavea student considered ready leave synchronization constraint applies student order maintain illusion social suave student si t table student considered sitting wh o invoked dine invokesleavebefore ﬁnished dine puzzle write code enforces remotely classical dining hall problem dining hall problem hint dining hall problem hint semaphore semaphore eatingandreadytoleave counter protected mutex usual scoreboard pattern student ready leave student le ft table wait oktoleave student change situation remotely classical dining hall problem dining hall problem solution analyze constraint realize s situation student wait student eating student want leave way situat ion student arrive eat dining student ﬁnis case student signal waiting student u pdates counter waiting student doesn t mute x example ll pattern dining hall problem solution eating readytoleave readytoleave eating readytoleave eating readytoleave readytoleave readytoleave student checking see student eating waiting leave let waiter oﬀ hook decrement readytoleave remotely classical problem dining student check case student left eating departing stude nt mutex wait departing student ﬁnds waiting signal update counter just decrement readytoleave leaf extended dining hall problem dining hall problem get little challenging dd step student come lunch invoke getfood dineand leave invoking getfood invoking dine student considered ready eat similarly invoking dinea student considered ready leave synchronization constraint applies student sit table student considered sitting ei ther invokes dinewhile table ready eat invoked dineinvokesleavebefore ﬁnished dine puzzle write code enforces dining hall problem extended dining hall problem hint variable used solution extended dining hall problem hint semaphore semaphore semaphore readytoeat eatingandreadytoleave counter protected mutex student situation proceed wa onoktosit oroktoleave student change situation signal used variable named hasmutex help track thread hold remotely classical dining hall problem extended dining hall problem solution analyze constraint realize s situation student ready eat wait e eating ready eat way arrives ready eat extended dining hall problem solution eating readytoeat eating readytoeat readytoeat eating readytoeat eating readytoleave readytoleave eating readytoleave eating readytoleave readytoleave readytoleave remotely classical problem previous solution used ll pat tern waiting student doesn t mutex primary diﬀerence solution previou s ﬁrst student arrives table wait second student allows student proceed case d t check student waiting leave leave table chapter synchronization python using pseudocode avoided ugly detail tion real world chapter ll look real sync hronization code python chapter ll look python provides reasonably pleasant multithreading envi ronment plete semaphore object foible cleanup code appendix athat make thing little better simple example listing import shared def self shared true print shared thread shared range child child ﬁrst line run cleanup code appendix leave line example shareddeﬁnes object type contain shared variable gl obal variable shared thread won t use ny ples thread local sense declar ed inside function local sense synchronization python child code inﬁnite loop increment counter print new value sleep second parent thread creates sharedand child wait dren exit case won t mutex checker problem diligent student synchronization notice c hildren make chronized update counter safe run program error probably won t nasty g nization error unpredictable mean extensive testing reveal detect error necessary automate searc case detect error keeping track value counter listing shared def self end shared true break shared thread shared range child child example sharedcontains list misleadingly named array keep track number time value counter use time loop child check counter quit exceeds end use counter index arrayand increment corresponding entry increment counter work correctly entry array shoul d incremented exactly child exit parent return fro mjoinand print value array ran program got disappointingly correct increase size array expect error get harder check resul mutex checker problem automate checker making histogram resul t array listing histogram dict def self item seq self item item histogram run program mean value appeared time expected n o error far make endbigger thing interesting end end end end oops endis big lot context switch child start synchronization error thi s case lot error suggests program fall recur ring pattern thread consistently interrupted critical secti example demonstrates danger synchroniza tion error rare random er ror occurs time million doesn t mean won t happen million time row puzzle add synchronization code program enforce exclusive cess shared variable download code thi s section synchronization mutex checker problem mutex checker hint version sharedi used listing shared def self end semaphore change semaphore named mutex come synchronization mutex checker problem mutex checker solution solution listing shared true break diﬃcult synchronization probl em book tricky detail right par ticular easy forget signal mutex breaking loop cause deadlock ran solution end got following result course doesn t mean solution correct oﬀ good synchronization coke machine problem coke machine problem thefollowing programsimulates producersandconsumersad dingandremoving coke coke machine listing random shared def self start consume shared print produce shared print loop shared f true t t f shared shared consume produce thread loop shared f f f thread thread capacity coke machine initially ha lf shared variable cokesis program creates thread producer consume r run loop producer invoke produce consumer invoke consume function make unsynchronized access shared vari able time loop producer consumer sleep fo r duration chosen exponential distribution mean mu producer consumer coke added machi ne second average removed average number coke constant short run vary quite widely run program probably value ofcokesdip zero climb course synchronization python puzzle add code program enforce following syn chronization constraint cokesshould mutually exclusive number coke zero consumer block coke added producersshouldblockuntilaco keisremoved youcandownloadtheprogramfrom coke machine problem coke machine hint shared variable used solution listing shared def self semaphore start semaphore semaphore cokesis semaphore simple integer make s tricky print value course access value semaphore python usual way doesn t pro vide cheater method implementation ﬁnd interesting know value sem aphore stored private attribute named semaphore value case don t know python doesn t actually enforce restrictio n access private attribute access course thou ght interested synchronization coke machine problem coke machine solution ve read rest book tro uble coming good listing consume shared print produce shared print run program able conﬁr m number coke machine negative greater th solution correct synchronization pythonchapter synchronization c section write multithreaded synchronized program pendixbprovides utility code use make c code litt le palatable example section depend c ode mutual exclusion ll start deﬁning structure contains shared vari ables listing struct counter end array shared int end shared sizeof shared counter end end array end sizeof int end array shared synchronization c counter shared variable incremented concurrent t hreads reach end use arrayto check synchronization error keeping track value counter increment parent code code parent thread us create thread w ait complete listing main child shared child entry shared child shared ﬁrst loop creates child thread second loop wait s complete child ﬁnished parent invoke scheckarrayto check error makethreadandjointhreadare deﬁned appendix b child code code executed child listing shared shared counter end return array counter mutual exclusion time loop child thread use counter index arrayand increment corresponding element increme ntcounter check synchronization error work correctly element array sho uld incremented check error just count number el ements listing shared shared end array d error download program including cleanup code f rom compile run program output like starting child counter child starting child counter child checking error ofcourse theinteractionofthechildrendependsondetail sofyouroperating program running computer t synchronization c shown thread ran way endbefore thread got started surprising synchr onization error butasendgetsbigger therearemorecontextswitchesbetweenthechi ldren start error endis puzzle use semaphore enforce exclusive access sh ared variable run program conﬁrm mutual exclusion mutual exclusion hint version sharedi used solution listing struct counter end array mutex shared int end shared sizeof shared counter end end array end sizeof int end array mutex shared semaphore line mutex value synchronization mutual exclusion mutual exclusion solution synchronized version child code listing shared shared mutex counter end mutex return array counter mutex surprising tricky thing s remember release mutex returnstatement youcandownloadthissolutionfrom synchronization make semaphore make semaphore commonly used synchronization tool program t hat use pthreads mutexes condition variable semaphore explanation tool recommend butenhof s programming posix thread puzzle read mutexes condition variable n use write implementation semaphore want use following utility code solut ion wrapper pthreads mutexes listing mutex mutex sizeof mutex n mutex null n failed mutex mutex mutex n mutex n lock failed mutex mutex n mutex n unlock failed synchronization c wrapper pthread condition variable listing cond cond sizeof cond n cond null n failed cond cond cond mutex mutex n cond mutex n failed cond cond n cond n failed make semaphore semaphore implementation hint structure deﬁnition used semaphore listing struct value wakeups mutex cond semaphore valueis value semaphore wakeups count number pending signal number thread woken b ut resumed execution reason wakeups make sure tha t semaphore property described section mutexprovides exclusive access valueandwakeups condis condition variable thread wait wait semaphore initialization code structure listing int value semaphore sizeof semaphore value value wakeups mutex cond semaphore synchronization make semaphore semaphore implementation implementation semaphore using pthread s mut ex tion variable listing semaphore semaphore mutex value value cond mutex wakeups wakeups mutex semaphore semaphore mutex value cond mutex straightforward thing tricky loop line unusual way use condition variable case necessary puzzle t replace loop whileloop synchronization make semaphore semaphore implementation awhileloop implementation property woul d possible thread signal run catc h signal loop thread signal waiting thread signal th read get mutex waiting thread resume turn spurious wakeup http violate synchronization cbibliography gregory andrew concurrent programming principle practice david butenhof programming posix thread edsger dijkstra cooperating sequential process reprinted programming language genuys academic press new york armando gingras dining philosopher revisited acm sigcse letin september max hailperin operating system middleware supporting controlled interaction thompson course technology joseph morris solution mutu al exclusion processing letter february david parnas solution cigarette smoker p roblem conditional statement communication acm march suhaspatil limitationsandcapabilitiesofdijkstra ssemaphoreprimitives coordination process technical report mit kenneth reek design pattern semaphore acm sigcse abrahamsilberschatzandpeterbaergalvin operating system concept addison wesley ﬁfth edition william stalling operating system internals design principle prentice hall fourth edition andrew tanenbaum modern operating system prentice hall second edition bibliographyappendix cleaning python thread compared lot threading environment python th read pretty good couple feature annoy fortun ately ﬁx little code semaphore method method python semaphore called acquire andrelease perfectly reasonable choice working book couple year used signalandwait fortunately way subclassing version semaphore threading module semaphore change threading semaphore wait signal class deﬁned create manipulate sema phores using syntax book semaphore example semaphore creating thread feature threading module annoys interface creating starting thread usual way requires keywo rd argument cleaning python thread step thread example standard way threading function x y z print x y z example creating thread immediate eﬀect invoke start new thread executes target function given argument great need t hread start think keyword argum entstargetand argsare awkward fortunately solve problem li ne code thread class thread def self t args self create thread nicer interface sta rt cally thread example way thread function lends idiom like create mu ltiple thread list comprehension multiple thread example thread function range handling keyboard interrupt oneotherproblemwiththe threading classisthat rupted generates signal sigint python translates handling keyboard interrupt write following program unstoppable program threading time thread def self t args self child thread range n print ﬁnd interrupted workaround problem us work unix macintosh s work creating n ew thread program invokes watcher fork new process new process return executes rest program original process wa child process complete watcher watcher threading time o signal sys thread def self t args self child thread range n print time writing bug reported assigned nu mber open unassigned http cleaning python thread watcher child child return try keyboardinterrupt print keyboardinterrupt child run version program able terrupt sure think guaranteed sigintis delivered watcher process s thing parent d child thread deal code ﬁle named threading download example chapter presented understanding code executes prior example b cleaning posix thread section present utility code use make mult ithreading c little pleasant example section based code probably popular threading standard used c p osix thread pthreads short posix standard deﬁnes t hread model interface creating controlling thread version unix provide implementation pthreads compiling pthread code using pthreads like using c library include header ﬁles beginning program write code call function deﬁned pthreads compile program link pthread lib rary example include following header header include include include include ﬁrst standard pthreads fo urth semaphore compile pthread library gcc use option command line listing array cleaning posix thread compiles debugging info optimization link pthread library generates executable named array used language like python provides ion handling probably annoyed language like c requi check error condition explicitly mitigate hass le wrapping library function call code in ide function example version mallocthat check return value listing int size p malloc size p null perror malloc failed exit p creating thread ve thing pthread function m going use s wrapper pthread create listing void entry void shared shared n thread thread null entry void shared n perror failed exit thread return type pthread createispthread t think handle new thread shouldn t worry bout implementation pthread t butyoudohavetoknowthatithasthesemantics primitive mean think thread handle integer example pthread ti implementation creating thread immutablevalue soyoucancopyitorpassitbyvaluewithout causingproblems point true semaphore whi ch minute ifpthread createsucceeds return function return handle new thread error occurs pthread createreturns error code function print error message exit parameter pthread createtake explaining starting second sharedis structure contains shared variable following typedef statement creates new type listing struct counter shared case shared variable space sharedstructure initializes content listing shared sizeof shared counter shared shared data structure let s pthread create ﬁrst parameter pointer function take voidpointer return voidpointer syntax declaring type make eye s bleed purpose paramet er specify function execution new thread begin convention function named entry listing entry void arg shared shared arg shared null parameter entryhas declared voidpointer program know really pointer sharedstructure typecast accordingly pas childcode doe real cleaning posix thread whenchildcodereturns invoke pthread exitwhich used pas value thread usually parent join wit h thread case child say pas null joining thread thread want wait thread complete t invokes pthread join wrapper pthread join listing thread ret thread null ret perror failed exit parameter handle thread want wait function doe pthread joinand check result semaphore posix standard speciﬁes interface semaphore th interface pthreads unix implement pthread s provide semaphore ﬁnd pthreads se maphores make section posix semaphore type semt shouldn t know implementation type know t structure semantics mean assign variable making copy content structure copying semaphore certainly bad idea posix behavior copy undeﬁned program use capital letter denote type str ucture tic manipulate pointer fortunate ly easy wrapper semtto make behave like proper object typedef wrapper creates initializes semaphore listing semaphore int n sem sizeof semaphore ret sem n semaphore ret perror failed exit sem makesemaphore take initial value semaphore parameter allocates space semaphore initializes retu rn pointer semaphore seminituses unix error reporting mean ret urn went wrong nice thing wrapp er function don t remember function use repo rting style deﬁnitions write c code look l ike real programming language listing mutex mutex mutex annoyingly posix semaphore use postinstead signal ﬁx listing semaphore sem sem s cleanup