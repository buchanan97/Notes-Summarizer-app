Computer Networking : Principles, Protocols and Practice Release 0.25 Olivier Bonaventure October 30, 2011 Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Contents 1 Preface 3 2 Introduction 5 2.1 Services and protocols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 2.2 The reference models . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20 2.3 Organisation of the book . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25 3 The application Layer 27 3.1 Principles . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27 3.2 Application-level protocols . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32 3.3 Writing simple networked applications . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55 3.4 Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 61 3.5 Exercises . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 61 4 The transport layer 67 4.1 Principles of a reliable transport protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 67 4.2 The User Datagram Protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 87 4.3 The Transmission Control Protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 89 4.4 Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 113 4.5 Exercises . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114 5 The network layer 127 5.1 Principles . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 127 5.2 Internet Protocol . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 140 5.3 Routing in IP networks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 170 5.4 Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 195 5.5 Exercises . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 195 6 The datalink layer and the Local Area Networks 211 6.1 Principles . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 211 6.2 Medium Access Control . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 214 6.3 Datalink layer technologies . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 228 6.4 Summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 246 6.5 Exercises . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 246 7 Glossary 249 8 Bibliography 255 i Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation 9 Indices and tables 257 Bibliography 259 Index 273 ii Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 Contents 1 Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 2 Contents Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation CHAPTER 1 Preface This textbook came from a frustration of its main author. Many authors chose to write a textbook because there are no textbooks in their ﬁeld or because they are not satisﬁed with the existing textbooks. This frustration has produced several excellent textbooks in the networking community. At a time when networking textbooks were mainly theoretical, Douglas Comer chose to write a textbook entirely focused on the TCP/IP protocol suite [Comer1988], a difﬁcult choice at that time. He later extended his textbook by describing a complete TCP/IP implementation, adding practical considerations to the theoretical descriptions in [Comer1988]. Richard Stevens approached the Internet like an explorer and explained the operation of protocols by looking at all the packets that were exchanged on the wire [Stevens1994]. Jim Kurose andKeith Ross reinvented the networking textbooks by starting from the applications that the students use and later explained the Internet protocols by removing one layer after the other [KuroseRoss09]. The frustrations that motivated this book are different. When I started to teach networking in the late 1990s, students were already Internet users, but their usage was limited. Students were still using reference textbooks and spent time in the library. Today’s students are completely different. They are avid and experimented web users who ﬁnd lots of information on the web. This is a positive attitude since they are probably more curious than their predecessors. Thanks to the information that is available on the Internet, they can check or obtain additional information about the topics explained by their teachers. This abundant information creates several challenges for a teacher. Until the end of the nineteenth century, a teacher was by deﬁnition more knowledgeable than his students and it was very difﬁcult for the students to verify the lessons given by their teachers. Today, given the amount of information available at the ﬁngertips of each student through the Internet, verifying a lesson or getting more information about a given topic is sometimes only a few clicks away. Websites such as wikipedia provide lots of information on various topics and students often consult them. Unfortunately, the organisation of the information on these websites is not well suited to allow students to learn from them. Furthermore, there are huge differences in the quality and depth of the information that is available for different topics. The second reason is that the computer networking community is a strong participant in the open-source movement. Today, there are high-quality and widely used open-source implementations for most networking protocols. This includes the TCP/IP implementations that are part of linux, freebsd or the uIPstack running on 8bits controllers, but also servers such as bind, unbound, apache orsendmail and implementations of routing protocols such asxorp orquagga . Furthermore, the documents that deﬁne almost all of the Internet protocols have been developed within the Internet Engineering Task Force (IETF) using an open process. The IETF publishes its protocol speciﬁcations in the publicly available RFC and new proposals are described in Internet drafts. This open textbook aims to ﬁll the gap between the open-source implementations and the open-source network speciﬁcations by providing a detailed but pedagogical description of the key principles that guide the operation of the Internet. The book is released under a creative commons licence. Such an open-source license is motivated by two reasons. The ﬁrst is that we hope that this will allow many students to use the book to learn computer networks. The second is that I hope that other teachers will reuse, adapt and improve it. Time will tell if it is possible to build a community of contributors to improve and develop the book further. As a starting point, the ﬁrst release contains all the material for a one-semester ﬁrst upper undergraduate or a graduate networking course. As of this writing, most of the text has been written by Olivier Bonaventure. Laurent Vanbever, Virginie Van den Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 Schriek, Damien Saucez and Mickael Hoerdt have contributed to exercises. Pierre Reinbold designed the icons used to represent switches and Nipaul Long has redrawn many ﬁgures in the SVG format. Stephane Bortzmeyer sent many suggestions and corrections to the text. Additional information about the textbook is available at http://inl.info.ucl.ac.be/CNP3 4 Chapter 1. Preface Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation CHAPTER 2 Introduction When the ﬁrst computers were built during the second world war, they were expensive and isolated. However, after about twenty years, as their prices gradually decreased, the ﬁrst experiments began to connect computers together. In the early 1960s, researchers including Paul Baran, Donald Davies orJoseph Licklider independently published the ﬁrst papers describing the idea of building computer networks [Baran] [Licklider1963] . Given the cost of computers, sharing them over a long distance was an interesting idea. In the US, the ARPANET started in 1969 and continued until the mid 1980s [LCCD09]. In France, Louis Pouzin developed the Cyclades network [Pouzin1975]. Many other research networks were built during the 1970s [Moore]. At the same time, the telecommunication and computer industries became interested in computer networks. The telecommunication industry bet on the X25. The computer industry took a completely different approach by designing Local Area Networks (LAN). Many LAN technologies such as Ethernet or Token Ring were designed at that time. During the 1980s, the need to interconnect more and more computers led most computer vendors to develop their own suite of networking protocols. Xerox developed [XNS] , DEC chose DECNet [Malamud1991] , IBM developed SNA [McFadyen1976] , Microsoft introduced NetBIOS [Winston2003] , Apple bet on Appletalk [SAO1990] . In the research community, ARPANET was decommissioned and replaced by TCP/IP [LCCD09] and the reference implementation was developed inside BSD Unix [McKusick1999]. Universities who were already running Unix could thus adopt TCP/IP easily and vendors of Unix workstations such as Sun or Silicon Graphics included TCP/IP in their variant of Unix. In parallel, the ISO, with support from the governments, worked on developing an open 1Suite of networking protocols. In the end, TCP/IP became the de facto standard that is not only used within the research community. During the 1990s and the early 2000s, the growth of the usage of TCP/IP continued, and today proprietary protocols are seldom used. As shown by the ﬁgure below, that provides the estimation of the number of hosts attached to the Internet, the Internet has sustained large growth throughout the last 20+ years. Figure 2.1: Estimation of the number of hosts on the Internet 1Open in ISO terms was in contrast with the proprietary protocol suites whose speciﬁcation was not always publicly available. The US government even mandated the usage of the OSI protocols (see RFC 1169), but this was not sufﬁcient to encourage all users to switch to the OSI protocol suite that was considered by many as too complex compared to other protocol suites. Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 Recent estimations of the number of hosts attached to the Internet show a continuing growth since 20+ years. However, although the number of hosts attached to the Internet is high, it should be compared to the number of mobile phones that are in use today. More and more of these mobile phones will be connected to the Internet. Furthermore, thanks to the availability of TCP/IP implementations requiring limited resources such as uIP [Dunkels2003], we can expect to see a growth of TCP/IP enabled embedded devices. Figure 2.2: Estimation of the number of mobile phones Before looking at the services provided by computer networks, it is useful to agree on some terminology that is widely used in networking literature. First of all, computer networks are often classiﬁed in function of the geographical area that they cover •LAN : a local area network typically interconnects hosts that are up to a few or maybe a few tens of kilometers apart. •MAN : a metropolitan area network typically interconnects devices that are up to a few hundred kilometers apart •WAN : a wide area network interconnect hosts that can be located anywhere on Earth2 Another classiﬁcation of computer networks is based on their physical topology. In the following ﬁgures, physical links are represented as lines while boxes show computers or other types of networking equipment. Computer networks are used to allow several hosts to exchange information between themselves. To allow any host to send messages to any other host in the network, the easiest solution is to organise them as a full-mesh, with a direct and dedicated link between each pair of hosts. Such a physical topology is sometimes used, especially when high performance and high redundancy is required for a small number of hosts. However, it has two major drawbacks : • for a network containing nhosts, each host must have n-1physical interfaces. In practice, the number of physical interfaces on a node will limit the size of a full-mesh network that can be built • for a network containing nhosts,n(n 1) 2links are required. This is possible when there are a few nodes in the same room, but rarely when they are located several kilometers apart The second possible physical organisation, which is also used inside computers to connect different extension cards, is the bus. In a bus network, all hosts are attached to a shared medium, usually a cable through a single interface. When one host sends an electrical signal on the bus, the signal is received by all hosts attached to the bus. A drawback of bus-based networks is that if the bus is physically cut, then the network is split into two isolated networks. For this reason, bus-based networks are sometimes considered to be difﬁcult to operate and maintain, especially when the cable is long and there are many places where it can break. Such a bus-based topology was used in early Ethernet networks. A third organisation of a computer network is a star topology. In such topologies, hosts have a single physical interface and there is one physical link between each host and the center of the star. The node at the center of the star can be either a piece of equipment that ampliﬁes an electrical signal, or an active device, such as a piece 2In this book, we focus on networks that are used on Earth. These networks sometimes include satellite links. Besides the network technologies that are used on Earth, researchers develop networking techniques that could be used between nodes located on different planets. Such an Inter Planetary Internet requires different techniques than the ones discussed in this book. See RFC 4838 and the references therein for information about these techniques. 6 Chapter 2. Introduction Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 Figure 2.3: A Full mesh network Figure 2.4: A network organised as a Bus of equipment that understands the format of the messages exchanged through the network. Of course, the failure of the central node implies the failure of the network. However, if one physical link fails (e.g. because the cable has been cut), then only one node is disconnected from the network. In practice, star-shaped networks are easier to operate and maintain than bus-shaped networks. Many network administrators also appreciate the fact that they can control the network from a central point. Administered from a Web interface, or through a console-like connection, the center of the star is a useful point of control (enabling or disabling devices) and an excellent observation point (usage statistics). Figure 2.5: A network organised as a Star A fourth physical organisation of a network is the Ring topology. Like the bus organisation, each host has a single physical interface connecting it to the ring. Any signal sent by a host on the ring will be received by all hosts attached to the ring. From a redundancy point of view, a single ring is not the best solution, as the signal only travels in one direction on the ring; thus if one of the links composing the ring is cut, the entire network fails. In practice, such rings have been used in local area networks, but are now often replaced by star-shaped networks. In metropolitan networks, rings are often used to interconnect multiple locations. In this case, two parallel links, composed of different cables, are often used for redundancy. With such a dual ring, when one ring fails all the trafﬁc can be quickly switched to the other ring. A ﬁfth physical organisation of a network is the tree. Such networks are typically used when a large number of customers must be connected in a very cost-effective manner. Cable TV networks are often organised as trees. In practice, most real networks combine part of these topologies. For example, a campus network can be organised as a ring between the key buildings, while smaller buildings are attached as a tree or a star to important buildings. Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 Figure 2.6: A network organised as a Ring Figure 2.7: A network organised as a Tree 8 Chapter 2. Introduction Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 Or an ISP network may have a full mesh of devices in the core of its network, and trees to connect remote users. Throughout this book, our objective will be to understand the protocols and mechanisms that are necessary for a network such as the one shown below. S R R R R R R R R R R R R R S R tux@linux#PSTN ISP1ISP2ISP2 ISP2alpha.combeta.be societe.fr ADSL Figure 2.8: A simple internetwork The ﬁgure above illustrates an internetwork, i.e. a network that interconnects other networks. Each network is illustrated as an ellipse containing a few devices. We will explain throughout the book the different types of devices and their respective roles enabling all hosts to exchange information. As well as this, we will discuss how networks are interconnected, and the rules that guide these interconnections. We will also analyse how the bus, ring and mesh topologies are used to build real networks. The last point of terminology we need to discuss is the transmission modes. When exchanging information through a network, we often distinguish between three transmission modes. In TV and radio transmission, broadcast is often used to indicate a technology that sends a video or radio signal to all receivers in a given geographical area. Broadcast is sometimes used in computer networks, but only in local area networks where the number of recipients is limited. The ﬁrst and most widespread transmission mode is called unicast . In the unicast transmission mode, information is sent by one sender to one receiver. Most of today’s Internet applications rely on the unicast transmission mode. The example below shows a network with two types of devices : hosts (drawn as computers) and intermediate nodes (drawn as cubes). Hosts exchange information via the intermediate nodes. In the example below, when host Suses unicast to send information, it sends it via three intermediate nodes. Each of these nodes receives the information from its upstream node or host, then processes and forwards it to its downstream node or host. This is called store and forward and we will see later that this concept is key in computer networks. A second transmission mode is multicast transmission mode. This mode is used when the same information must be sent to a set of recipients. It was ﬁrst used in LANs but later became supported in wide area networks. When a sender uses multicast to send information to Nreceivers, the sender sends a single copy of the information and the network nodes duplicate this information whenever necessary, so that it can reach all recipients belonging to the destination group. To understand the importance of multicast transmission, consider source Sthat sends the same information to destinations A,CandE. With unicast, the same information passes three times on intermediate nodes 1and2and twice on node 4. This is a waste of resources on the intermediate nodes and on the links between them. With multicast transmission, host Ssends the information to node 1that forwards it downstream to node 2. This node creates a copy of the received information and sends one copy directly to host Eand the other downstream to node 4. Upon reception of the information, node 4produces a copy and forwards one to node Aand another to node C. Thanks to multicast, the same information can reach a large number of receivers while being sent only once on each link. Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 AE S DCB Figure 2.9: Unicast transmission AE S DCB Figure 2.10: Multicast transmission 10 Chapter 2. Introduction Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 The last transmission mode is the anycast transmission mode. It was initially deﬁned in RFC 1542. In this transmission mode, a set of receivers is identiﬁed. When a source sends information towards this set of receivers, the network ensures that the information is delivered to onereceiver that belongs to this set. Usually, the receiver closest to the source is the one that receives the information sent by this particular source. The anycast transmission mode is useful to ensure redundancy, as when one of the receivers fails, the network will ensure that information will be delivered to another receiver belonging to the same group. However, in practice supporting the anycast transmission mode can be difﬁcult. S Figure 2.11: Anycast transmission In the example above, the three hosts marked with *are part of the same anycast group. When host Ssends information to this anycast group, the network ensures that it will reach one of the members of the anycast group. The dashed lines show a possible delivery via nodes 1,2and4. A subsequent anycast transmission from host Sto the same anycast group could reach the host attached to intermediate node 3as shown by the plain line. An anycast transmission reaches a member of the anycast group that is chosen by the network in function of the current network conditions. 2.1 Services and protocols An important aspect to understand before studying computer networks is the difference between a service and a protocol. In order to understand the difference between the two, it is useful to start with real world examples. The traditional Post provides a service where a postman delivers letters to recipients. The Post deﬁnes precisely which types of letters (size, weight, etc) can be delivered by using the Standard Mail service. Furthermore, the format of the envelope is speciﬁed (position of the sender and recipient addresses, position of the stamp). Someone who wants to send a letter must either place the letter at a Post Ofﬁce or inside one of the dedicated mailboxes. The letter will then be collected and delivered to its ﬁnal recipient. Note that for the regular service the Post usually does not guarantee the delivery of each particular letter, some letters may be lost, and some letters are delivered to the wrong mailbox. If a letter is important, then the sender can use the registered service to ensure that the letter will be delivered to its recipient. Some Post services also provide an acknowledged service or an express mail service that is faster than the regular service. In computer networks, the notion of service is more formally deﬁned in [X200] . It can be better understood by considering a computer network, whatever its size or complexity, as a black box that provides a service to users , as shown in the ﬁgure below. These users could be human users or processes running on a computer system. Many users can be attached to the same service provider. Through this provider, each user must be able to exchange messages with any other user. To be able to deliver these messages, the service provider must be able to unambiguously identify each user. In computer networks, each user is identiﬁed by a unique address, we will discuss later how these addresses are built and used. At this point, and when considering unicast transmission, the main characteristic of these addresses is that they are unique. Two different users attached to the network cannot use the same address. 2.1. Services and protocols 11 Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 User A User B Service provider ("the network")Service Access Point Primitives Figure 2.12: Users and service provider Throughout this book, we will deﬁne a service as a set of capabilities provided by a system (and its underlying elements) to its user. A user interacts with a service through a service access point. Note that as shown in the ﬁgure above, users interact with one service provider. In practice, the service provider is distributed over several hosts, but these are implementation details that are not important at this stage. These interactions between a user and a service provider are expressed in [X200] by using primitives, as show in the ﬁgure below. These primitives are an abstract representation of the interactions between a user and a service provider. In practice, these interactions could be implemented as system calls for example. User A User B Service provider ("the network")X.indication X.response X.confirm X.request Figure 2.13: The four types of primitives Four types of primitives are deﬁned : •X.request. This type of primitive corresponds to a request issued by a user to a service provider •X.indication. This type of primitive is generated by the network provider and delivered to a user (often related to an earlier and remote X.request primitive) •X.response. This type of primitive is generated by a user to answer to an earlier X.indication primitive •X.conﬁrm. This type of primitive is delivered by the service provide to conﬁrm to a user that a previous X.request primitive has been successfully processed. Primitives can be combined to model different types of services. The simplest service in computer networks is called the connectionless service3. This service can be modelled by using two primitives : •Data.request(source,destination,SDU). This primitive is issued by a user that speciﬁes, as parameters, its (source) address, the address of the recipient of the message and the message itself. We will use Service Data Unit (SDU) to name the message that is exchanged transparently between two users of a service. •Data.indication(source,destination,SDU). This primitive is delivered by a service provider to a user. It contains as parameters a Service Data Unit as well as the addresses of the sender and the destination users. When discussing the service provided in a computer network, it is often useful to be able to describe the interactions between the users and the provider graphically. A frequently used representation is the time-sequence diagram. In this chapter and later throughout the book, we will often use diagrams such as the ﬁgure below. A time-sequence diagram describes the interactions between two users and a service provider. By convention, the users are represented in the left and right parts of the diagram while the service provider occupies the middle of the diagram. In such a time-sequence diagram, time ﬂows from the top, to the bottom of the diagram. Each primitive 3This service is called the connectionless service because there is no need to create a connection before transmitting any data in contrast with the connection-oriented service. 12 Chapter 2. Introduction Saylor URL: http://www.saylor.org/courses/cs402/ The Saylor Foundation Computer Networking : Principles, Protocols and Practice, Release 0.25 is represented by a plain horizontal arrow, to which the name of the primitive is attached. The dashed lines are used to represent the possible relationship between two (or more) primitives. Such a diagram provides information about the ordering of the different primitives, but the distance between two primitives does not represent a precise amount of time. The ﬁgure below provides a representation of the connectionless service as a time-sequence diagram. The user on the left, having address S, issues a Data.request primitive containing SDU Mthat must be delivered by the service provider to destination D. The dashed line between the two primitives indicates that the Data.indication primitive that is delivered to the user on the right corresponds to the Data.request primitive sent by the user on the left. Source Provider Destination DATA.request(S, D, "M") DATA.indication(S, D, "M") Time Figure 2.14: A simple connectionless service There are several possible implementations of the connectionless service, which we will discuss later in this book. Before studying these realisations, it is useful to discuss the possible characteristics of the connectionless service. Areliable connectionless service is a service where the service provider guarantees that all SDUs submitted in Data.requests by a user will eventually be delivered to their destination. Such a service would be very useful for users, but guaranteeing perfect delivery is difﬁcult in practice. For this reason, computer networks usually support anunreliable connectionless service. Anunreliable connectionless service may suffer from various types of problems compared to a reliable connectionless service. First of all, an unreliable connectionless service does not guarantee the delivery of all SDUs. This can be expressed grap