PharoByExample5 StéphaneDucasse,DimitrisChloupis,NicolaiHess,andDmitriZagidulin September29,2018 Copyright 2017 by Stéphane Ducasse, Dimitris Chloupis, Nicolai Hess, and Dmitri Zagidulin. The contents of this book are protected under the Creative Commons AttributionShareAlike 3.0 Unported license. You arefree: •toShare: to copy, distribute and transmit the work, •toRemix: to adapt the work, Under the following conditions: Attribution. You must attribute the work in the manner specified by the author or licensor (but not in any way that suggests that they endorse you or your use of the work). ShareAlike. If you alter, transform, or build upon this work, you may distribute the resulting work only under the same, similar or a compatible license. For any reuse or distribution, you must make clear to others the license terms of this work. The best way to do this is with a link to this web page: http://creativecommons.org/licenses/by-sa/3.0/ Any of the above conditions can be waived if you get permission from the copyright holder. Nothing in this license impairs or restricts the author’s moral rights. Your fair dealing and other rights are in no way affected by the above. This is a humanreadable summary of the Legal Code (the full license): http://creativecommons.org/licenses/by-sa/3.0/legalcode Layout and typography based on the sbabook LATEX class by Damien Pollet. Contents Illustrations vi 1 Preface 1 1.1 WhatisPharo? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1 1.2 Whoshouldreadthisbook? . . . . . . . . . . . . . . . . . . . . . . . . . . 2 1.3 Awordofadvice . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3 1.4 Anopenbook . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3 1.5 ThePharocommunity . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3 1.6 Examplesandexercises . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4 1.7 Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4 1.8 Hyperspecialacknowledgments . . . . . . . . . . . . . . . . . . . . . . . 5 2 A quick tour of Pharo 7 2.1 InstallingPharo . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7 2.2 Pharo: FileComponents . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 2.3 LaunchingPharo . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9 2.4 PharoLauncher . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 2.5 TheWorldMenu . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 2.6 SendingMessages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14 2.7 Saving,QuittingandRestartingaPharoSession . . . . . . . . . . . . . . . 15 2.8 PlaygroundsandTranscripts . . . . . . . . . . . . . . . . . . . . . . . . . 16 2.9 KeyboardShortcuts . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 2.10 TheSystemBrowser . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20 2.11 FindingClasses . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22 2.12 FindingMethods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 2.13 DefiningaNewMethod . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28 2.14 ChapterSummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32 3 A first application 33 3.1 TheLightsOutgame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34 3.2 CreatinganewPackage . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34 3.3 Definingtheclass LOCell . . . . . . . . . . . . . . . . . . . . . . . . . . . 35 3.4 Addingmethodstoaclass . . . . . . . . . . . . . . . . . . . . . . . . . . . 37 3.5 Inspectinganobject . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 39 3.6 Definingtheclass LOGame . . . . . . . . . . . . . . . . . . . . . . . . . . . 41 3.7 Organizingmethodsintoprotocols . . . . . . . . . . . . . . . . . . . . . . 46 i Contents 3.8 Finishingthegame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47 3.9 Let’stryourcode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49 3.10 SavingandsharingPharocode . . . . . . . . . . . . . . . . . . . . . . . . 52 3.11 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 56 4 Syntax in a nutshell 59 4.1 Syntacticelements . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59 4.2 Pseudo-variables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 62 4.3 Messagesends . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63 4.4 Methodsyntax . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64 4.5 Blocksyntax . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65 4.6 Conditionalsandloopsinanutshell . . . . . . . . . . . . . . . . . . . . . . 66 4.7 Primitivesandpragmas . . . . . . . . . . . . . . . . . . . . . . . . . . . . 68 4.8 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69 5 Understanding message syntax 71 5.1 Identifyingmessages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 71 5.2 Threetypesofmessages . . . . . . . . . . . . . . . . . . . . . . . . . . . 73 5.3 Messagecomposition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76 5.4 Hintsforidentifyingkeywordmessages . . . . . . . . . . . . . . . . . . . . 82 5.5 Expressionsequences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 83 5.6 Cascadedmessages . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84 5.7 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84 6 The Pharo object model 87 6.1 Therulesofthemodel . . . . . . . . . . . . . . . . . . . . . . . . . . . . 87 6.2 EverythingisanObject . . . . . . . . . . . . . . . . . . . . . . . . . . . . 87 6.3 Everyobjectisaninstanceofaclass . . . . . . . . . . . . . . . . . . . . . 88 6.4 Instancestructureandbehavior . . . . . . . . . . . . . . . . . . . . . . . . 89 6.5 Theinstancesideandtheclassside . . . . . . . . . . . . . . . . . . . . . . 90 6.6 Everyclasshasasuperclass . . . . . . . . . . . . . . . . . . . . . . . . . . 96 6.7 Everythinghappensbysendingmessages . . . . . . . . . . . . . . . . . . 100 6.8 Methodlookupfollowstheinheritancechain . . . . . . . . . . . . . . . . . 101 6.9 Sharedvariables . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 108 6.10 Internalobjectimplementationnote . . . . . . . . . . . . . . . . . . . . . 112 6.11 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 113 7 Some of the key tools of the Pharo environment 115 7.1 Pharoenvironmentoverview . . . . . . . . . . . . . . . . . . . . . . . . . 115 7.2 Themaincodebrowser . . . . . . . . . . . . . . . . . . . . . . . . . . . . 117 7.3 Theinspector . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 130 7.4 Thedebugger . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 132 7.5 Theprocessbrowser . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 141 7.6 Findingmethods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 142 7.7 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 142 ii Contents 8 Sharing code and source control 145 8.1 Packages: groupsofclassesandmethods . . . . . . . . . . . . . . . . . . 145 8.2 Sourcecontrol . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 152 8.3 TheFileListBrowser . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 155 8.4 InPharo,youcan’tlosecode . . . . . . . . . . . . . . . . . . . . . . . . . 156 8.5 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 157 9 SUnit 159 9.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 159 9.2 Whytestingisimportant . . . . . . . . . . . . . . . . . . . . . . . . . . . 160 9.3 Whatmakesagoodtest? . . . . . . . . . . . . . . . . . . . . . . . . . . . 161 9.4 SUnitbyexample . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 162 9.5 TheSUnitcookbook . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 166 9.6 TheSUnitframework . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 167 9.7 AdvancedfeaturesofSUnit . . . . . . . . . . . . . . . . . . . . . . . . . . 171 9.8 Continuingafterafailure . . . . . . . . . . . . . . . . . . . . . . . . . . . 172 9.9 SUnitimplementation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 173 9.10 Apieceofadvicesontesting . . . . . . . . . . . . . . . . . . . . . . . . . 175 9.11 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 177 10 Basic classes 179 10.1 Object . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 179 10.2 Numbers . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 189 10.3 Characters . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 193 10.4 Strings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 194 10.5 Booleans . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 195 10.6 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 197 10.7 Collections . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 197 10.8 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 197 10.9 Thevarietiesofcollections . . . . . . . . . . . . . . . . . . . . . . . . . . 197 10.10 Collectionimplementations . . . . . . . . . . . . . . . . . . . . . . . . . . 200 10.11 Examplesofkeyclasses . . . . . . . . . . . . . . . . . . . . . . . . . . . . 201 10.12 Collectioniterators . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 213 10.13 Somehintsforusingcollections . . . . . . . . . . . . . . . . . . . . . . . . 217 10.14 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 219 11 Streams 221 11.1 Twosequencesofelements . . . . . . . . . . . . . . . . . . . . . . . . . . 221 11.2 Streamsvs. collections . . . . . . . . . . . . . . . . . . . . . . . . . . . . 222 11.3 Streamingovercollections . . . . . . . . . . . . . . . . . . . . . . . . . . 223 11.4 Usingstreamsforfileaccess . . . . . . . . . . . . . . . . . . . . . . . . . 231 11.5 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 234 iii Contents 12 Morphic 235 12.1 ThehistoryofMorphic . . . . . . . . . . . . . . . . . . . . . . . . . . . . 235 12.2 Manipulatingmorphs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 237 12.3 Composingmorphs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 238 12.4 Creatinganddrawingyourownmorphs . . . . . . . . . . . . . . . . . . . 240 12.5 Interactionandanimation . . . . . . . . . . . . . . . . . . . . . . . . . . . 243 12.6 Interactors . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 247 12.7 Drag-and-drop . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 248 12.8 Acompleteexample . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 251 12.9 Moreaboutthecanvas . . . . . . . . . . . . . . . . . . . . . . . . . . . . 256 12.10 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 257 13 Seaside by example 259 13.1 WhydoweneedSeaside? . . . . . . . . . . . . . . . . . . . . . . . . . . . 259 13.2 Gettingstarted . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 260 13.3 Seasidecomponents . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 268 13.4 RenderingHTML . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 270 13.5 CSS:Cascadingstylesheets . . . . . . . . . . . . . . . . . . . . . . . . . . 277 13.6 Managingcontrolflow . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 279 13.7 Acompletetutorialexample . . . . . . . . . . . . . . . . . . . . . . . . . 285 13.8 AquicklookatAJAX . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 292 13.9 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 295 14 Reflection 297 14.1 Introspection . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 298 14.2 Browsingcode . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 303 14.3 Classes,methoddictionariesandmethods . . . . . . . . . . . . . . . . . . 305 14.4 Browsingenvironments . . . . . . . . . . . . . . . . . . . . . . . . . . . . 307 14.5 Accessingtherun-timecontext . . . . . . . . . . . . . . . . . . . . . . . . 309 14.6 Interceptingmessagesnotunderstood . . . . . . . . . . . . . . . . . . . . 312 14.7 Objectsasmethodwrappers . . . . . . . . . . . . . . . . . . . . . . . . . 317 14.8 Pragmas . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 319 14.9 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 321 15 Regular expressions in Pharo 323 15.1 Tutorialexample—generatingasitemap . . . . . . . . . . . . . . . . . . 324 15.2 Regexsyntax . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 332 15.3 RegexAPI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 339 15.4 ImplementationNotesbyVassiliBykov . . . . . . . . . . . . . . . . . . . . 345 15.5 ChapterSummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 346 16 Classes and metaclasses 347 16.1 Rulesforclassesandmetaclasses . . . . . . . . . . . . . . . . . . . . . . . 347 16.2 RevisitingthePharoobjectmodel . . . . . . . . . . . . . . . . . . . . . . . 348 16.3 Everyclassisaninstanceofametaclass . . . . . . . . . . . . . . . . . . . 349 16.4 Themetaclasshierarchyparallelstheclasshierarchy . . . . . . . . . . . . . 351 iv Contents 16.5 Everymetaclassinheritsfrom ClassandBehavior . . . . . . . . . . . . . 353 16.6 Everymetaclassisaninstanceof Metaclass . . . . . . . . . . . . . . . . . 356 16.7 Themetaclassof Metaclass isaninstanceof Metaclass . . . . . . . . . . 356 16.8 Chaptersummary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 358 v Illustrations 1-1 Smallexample . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4 2-1 Launchingpattern . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10 2-2 LaunchingPharofromLinux . . . . . . . . . . . . . . . . . . . . . . . . . 10 2-3 LaunchingPharofromMacOSX . . . . . . . . . . . . . . . . . . . . . . . 10 2-4 LaunchingPharofromWindows . . . . . . . . . . . . . . . . . . . . . . . 10 2-5 PharoLauncher-GUI . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11 2-6 ClickinganywhereonthePharowindowbackgroundactivatestheWorld Menu. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 2-7 ActionClick(rightclick)bringsthecontextualmenu. . . . . . . . . . . . . . 13 2-8 Meta-ClickingonawindowopenstheHalos . . . . . . . . . . . . . . . . . 13 2-9 OpenProfStefinthe Playground .. . . . . . . . . . . . . . . . . . . . . . 14 2-10 Executinganexpressionissimplewiththe Do itmenuitem. . . . . . . . . 14 2-11 PharoTutorialisasimpleinteractivetutorialtolearnaboutPharo . . . . . . 15 2-12 Executinganexpresssion: displayingastringintheTranscript. . . . . . . . 17 2-13 Inspectingasimplenumberusing Inspect . . . . . . . . . . . . . . . . . 18 2-14 InspectingaMorphusing Inspect . . . . . . . . . . . . . . . . . . . . . . 19 2-15 TheSystemBrowsershowingthe factorial methodofclass Integer . .20 2-16 TheSystemBrowsershowingthe printString methodofclass Object . .21 2-17 OpeningSpotter . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23 2-18 Lookingforimplementorsmatching printString . . . . . . . . . . . . . 24 2-19 TheFindershowingallclassesdefiningamethodnamed now.. . . . . . . . 27 2-20 Definingatestmethodintheclass StringTest .. . . . . . . . . . . . . . . 29 2-21 Lookingattheerrorinthedebugger. . . . . . . . . . . . . . . . . . . . . . 30 2-22 PressingtheCreatebuttoninthedebuggerpromptsyoutoselectin whichclasstocreatethenewmethod. . . . . . . . . . . . . . . . . . . . . 30 2-23 Theautomaticallycreated shoutmethodwaitingforarealdefinition. . . . . 31 3-1 TheLightsOutgameboard . . . . . . . . . . . . . . . . . . . . . . . . . . 33 3-2 CreateaPackageandclasstemplate . . . . . . . . . . . . . . . . . . . . . 34 3-3 Filteringourpackagetoworkmoreefficiently . . . . . . . . . . . . . . . . 35 3-4LOCellclassdefinition . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35 3-5 Thenewly-createdclassLOCell . . . . . . . . . . . . . . . . . . . . . . . . 36 3-6 InitializinginstanceofLOCell . . . . . . . . . . . . . . . . . . . . . . . . . 38 3-7 Thenewly-createdmethod initialize . . . . . . . . . . . . . . . . . . . 38 3-8 Theinspectorusedtoexaminea LOCellobject. . . . . . . . . . . . . . . 40 3-9 Whenweclickonaninstancevariable,weinspectitsvalue(anotherobject) .40 vi Illustrations 3-10 AnLOCellopeninworld . . . . . . . . . . . . . . . . . . . . . . . . . . . . 41 3-11 DefiningtheLOGameclass . . . . . . . . . . . . . . . . . . . . . . . . . . 42 3-12 Initializethegame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42 3-13 Declaring cellsasanewinstancevariable . . . . . . . . . . . . . . . . . 42 3-14 Pharodetectinganunknownselector . . . . . . . . . . . . . . . . . . . . . 43 3-15 Thesystemcreatedanewmethodwithabodytobedefined. . . . . . . . . 44 3-16 Defining cellsPerSide inthedebugger . . . . . . . . . . . . . . . . . . . 45 3-17 Initializethegame . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45 3-18 Aninitializationhelpermethod . . . . . . . . . . . . . . . . . . . . . . . . 47 3-19 Thecallbackmethod . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48 3-20 Dragamethodtoaprotocol . . . . . . . . . . . . . . . . . . . . . . . . . 48 3-21 Atypicalsettermethod . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48 3-22 Aneventhandler . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49 3-23 Thedebugger,withthemethod toggleNeighboursOfCell:at: selected .50 3-24 Fixingthebug. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51 3-25 Overridingmousemoveactions . . . . . . . . . . . . . . . . . . . . . . . . 51 3-26 FileOutourPBE-LightsOut . . . . . . . . . . . . . . . . . . . . . . . . . . 52 3-27 Importyourcodewiththefilebrowser . . . . . . . . . . . . . . . . . . . . 53 3-28 Monticellobrowser. ThepackagePBE-LightsOutisnotsaveyet . . . . . . . 54 3-29 Arepositorypattern . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55 3-30 CreateyourfirstrepositoryonSmalltalkHub . . . . . . . . . . . . . . . . . 55 3-31 Doyourfirstcommit . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 56 5-1 Twomessagesendscomposedofareceiver,amethodselector,anda setofarguments. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72 5-2aMorph color: Color yellow iscomposedoftwomessagesends: Color yelow andaMorph color: Color yellow .. . . . . . . . . . . . 72 5-3 Unarymessagesaresentfirstso Color yellow issent. Thisreturnsacolor 76 5-4 DecomposingtheevaluationofaPencolor: Coloryellow . . . . . . . . . . . 77 5-5 DecomposingaPengo: 100+20 . . . . . . . . . . . . . . . . . . . . . . . . 77 5-6 Binarymessagesaresentbeforekeyword . . . . . . . . . . . . . . . . . . 78 5-7 DecomposingPennewgo: 100+ . . . . . . . . . . . . . . . . . . . . . . . 78 5-8 DecomposingPennew . . . . . . . . . . . . . . . . . . . . . . . . . . . . 79 5-9 ExampleofParentheses. . . . . . . . . . . . . . . . . . . . . . . . . . . . 79 5-10 ExampleofUnnecessaryParentheses. . . . . . . . . . . . . . . . . . . . . 79 5-11 Decomposing20+2*5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80 5-12 Thetwomessages+and*areofthesamekindsotheirexecutionis fromlefttoright. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 80 5-13 Decomposing20+(2*5) . . . . . . . . . . . . . . . . . . . . . . . . . . . 81 5-14 Parenthesedexpressionsareexecutedfirst. . . . . . . . . . . . . . . . . . 81 5-15 Equivalentmessagesusingparentheses. . . . . . . . . . . . . . . . . . . . 81 5-16 Equivalentmessagesusingparentheses. . . . . . . . . . . . . . . . . . . . 81 vii Illustrations 6-1 Distancebetweentwopoints . . . . . . . . . . . . . . . . . . . . . . . . . 90 6-2 Browsingaclassanditsmetaclass . . . . . . . . . . . . . . . . . . . . . . 91 6-3 DogsandHyenas . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 93 6-4 Keepingcountofnewdogs . . . . . . . . . . . . . . . . . . . . . . . . . . 93 6-5. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 93 6-6 Asamplesingletonclass, WebServer . . . . . . . . . . . . . . . . . . . . . 95 6-7 Theclasssideofthesingletonclass . . . . . . . . . . . . . . . . . . . . . . 95 6-8 Newstateforclasses . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 95 6-9 Class-sideaccessormethod uniqueInstance . . . . . . . . . . . . . . . . 95 6-10Magnitude>> < . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 98 6-11Magnitude>> > =. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 98 6-12Character>> < =. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 98 6-13 Defininganewtrait . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 98 6-14 Anauthormethod . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 99 6-15 Usingatrait . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 99 6-16 Behaviordefinedusingtraits . . . . . . . . . . . . . . . . . . . . . . . . . 100 6-17 Alocallyimplementedmethod . . . . . . . . . . . . . . . . . . . . . . . . 102 6-18 Aninheritedmethod . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 102 6-19 Methodlookupfollowstheinheritancehierarchy . . . . . . . . . . . . . . . 103 6-20 Explicitlyreturning self. . . . . . . . . . . . . . . . . . . . . . . . . . . . 103 6-21 Superinitialize . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104 6-22 Aselfsend. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 105 6-23 A selfsend. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 105 6-24 Combining superandselfsends. . . . . . . . . . . . . . . . . . . . . . 106 6-25selfandsupersends. . . . . . . . . . . . . . . . . . . . . . . . . . . . 106 6-26 Message fooisnotunderstood . . . . . . . . . . . . . . . . . . . . . . . . 108 6-27 Instanceandclassmethodsaccessingdifferentvariables . . . . . . . . . . 110 6-28 Coloranditsclassvariables . . . . . . . . . . . . . . . . . . . . . . . . . . 111 6-29 Initializingthe Colorclass. . . . . . . . . . . . . . . . . . . . . . . . . . 111 6-30 Pooldictionariesinthe Textclass. . . . . . . . . . . . . . . . . . . . . . 112 6-31Text>>testCR . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 112 7-1 WindowGroupwithtwotabs,onewithPlaygroundandonewithSystem Browser . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 117 7-2 Themaincodebrowser. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118 7-3 Thebrowserwiththeclass Boolean selected. . . . . . . . . . . . . . . . . 118 7-4 Browsingthe or:methodinclass Boolean.. . . . . . . . . . . . . . . . . 119 7-5 Browsershowingtheclass-creationtemplate . . . . . . . . . . . . . . . . . 120 7-6 Showingthemethod-creationtemplate. . . . . . . . . . . . . . . . . . . . 121 7-7 The Senders Of...(b,n) menuitem. . . . . . . . . . . . . . . . . . . . 122 7-8 TheSendersBrowsershowingthatthe Canvas>>draw methodsends thedrawOn: messagetoitsargument. . . . . . . . . . . . . . . . . . . . . 123 7-9 Findingsendersofakeywordmessageinthecodepane. . . . . . . . . . . 124 7-10ImageMorph>>drawOn: andthehierarchyofclassesoverridingit. . . . . . 126 7-11 Ahierarchyviewof ImageMorph .. . . . . . . . . . . . . . . . . . . . . . . 127 7-12 AMessage Browser foraccessesto boundsvariableof Morph.. . . . . . 128 viii Illustrations 7-13 BytecodeoftheImageMorph»#DrawOn: compiledmethod. . . . . . . . . . 129 7-14 Refactoringoperations. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 129 7-15 Inspecting DateAndTime now .. . . . . . . . . . . . . . . . . . . . . . . . 131 7-16 Abuggymethod . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 133 7-17 APreDebugWindow notifiesusofabug. . . . . . . . . . . . . . . . . . . . 133 7-18 Thedebuggershowingtheexecutionstackandthestateofvariousobjects. .134 7-19 Thedebuggerafterrestartingthe detect:ifFound:IfNone: method. . .136 7-20 Thedebuggerafterstepping Through thedo:methodseveraltimes. . . . .137 7-21 Thedebuggershowingwhy 'readme.txt' at: 7 isnotequalto dot.. . .138 7-22 Changingthe suffixmethodinthedebugger: askingforconfirmation oftheexitfromaninnerblock. . . . . . . . . . . . . . . . . . . . . . . . . 139 7-23 Asimpletestforthe suffixmethod . . . . . . . . . . . . . . . . . . . . . 139 7-25 Abettertestforthe suffixmethod . . . . . . . . . . . . . . . . . . . . . 139 7-24 Changingthe suffixmethodinthedebugger: fixingtheoff-by-one errorafteranSUnitassertionfailure. . . . . . . . . . . . . . . . . . . . . . 140 7-26 Insertinga haltintothe suffixmethod. . . . . . . . . . . . . . . . . . . 140 7-27 Asecondtestforthe suffixmethod: thetargethasnosuffix . . . . . . . . 141 7-28 TheProcessBrowsershowingalltheactivethreadbypriority. . . . . . . . . 142 8-1 TheMonticellobrowser. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 147 8-2 ARepositorybrowser. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 148 8-3 Twoclassesandoneextensioninthe PBEpackage. . . . . . . . . . . . . . 149 8-4 Anextensionmethodthatisalsobeinthe PBEpackage. . . . . . . . . . . . 149 8-5 Theas-yet-unsavedPBEpackageinMonticello. . . . . . . . . . . . . . . . . 150 8-6 Providingalogmessageforanewversionofapackage. . . . . . . . . . . . 151 8-7 Twoversionsofourpackagearenowinthepackagecache. . . . . . . . . . 151 8-8 Theversionsbrowsershowingtwoversionsofthe ObjTest>>testIVOffset method. . . . . . . . . . . . . . . . . . . . . . 152 8-9 TheChangeSortershowingallthechangesofonechangesetand offeringactionstomovechangestootherchangesets. . . . . . . . . . . . . 154 8-10 Afilelistbrowser. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 155 8-11 AFileContentsBrowseropenedonapackage. . . . . . . . . . . . . . . . . 156 9-1 AnExampleSetTestclass . . . . . . . . . . . . . . . . . . . . . . . . . . . 162 9-2 Settingupafixture . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 163 9-3 Testingsetmembership . . . . . . . . . . . . . . . . . . . . . . . . . . . . 163 9-4 Testingoccurrences . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 163 9-5 Testingremoval . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 164 9-6 RunningSUnittestsfromtheSystemBrowser. . . . . . . . . . . . . . . . . 164 9-7 RunningSUnittestsusingthe TestRunner .. . . . . . . . . . . . . . . . . . . 165 9-8 Executablecommentsintestmethods . . . . . . . . . . . . . . . . . . . . 165 9-9 Introducingabuginatest . . . . . . . . . . . . . . . . . . . . . . . . . . . 165 9-10 Testingerrorraising . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 167 9-11 ThefourclassesrepresentingthecoreofSUnit. . . . . . . . . . . . . . . . 168 9-12 AnexampleofaTestResourcesubclass . . . . . . . . . . . . . . . . . . . . 170 9-13 Runningonetest. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 173 ix Illustrations 9-14 Passingthetestcasetothetestresult . . . . . . . . . . . . . . . . . . . . 173 9-15 Catchingtestcaseerrorsandfailures . . . . . . . . . . . . . . . . . . . . . 174 9-16 Auto-buildingthetestsuite . . . . . . . . . . . . . . . . . . . . . . . . . . 174 9-17 Testresourceavailability . . . . . . . . . . . . . . . . . . . . . . . . . . . 175 9-18 Testresourcecreation . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 176 10-1 printOn: redefinition. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 181 10-2 Self-evaluationof Point . . . . . . . . . . . . . . . . . . . . . . . . . . . 182 10-3 Self-evaluationof Interval . . . . . . . . . . . . . . . . . . . . . . . . . 182 10-4 Objectequality . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 182 10-5 Equalityforcomplexnumbers . . . . . . . . . . . . . . . . . . . . . . . . 183 10-6 Hashmustbereimplementedforcomplexnumbers . . . . . . . . . . . . . 183 10-7 Copyingobjectsasatemplatemethod . . . . . . . . . . . . . . . . . . . . 186 10-8 Checkingapre-condition . . . . . . . . . . . . . . . . . . . . . . . . . . . 187 10-9 Signalingthatamethodisabstract . . . . . . . . . . . . . . . . . . . . . . 187 10-10initialize asanemptyhookmethod . . . . . . . . . . . . . . . . . . . 188 10-11newasaclass-sidetemplatemethod . . . . . . . . . . . . . . . . . . . . . 188 10-12 Thenumberhierarchy. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 189 10-13 Abstractcomparisonmethods . . . . . . . . . . . . . . . . . . . . . . . . 190 10-14 TheStringHierarchy. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 194 10-15 TheBooleanHierarchy. . . . . . . . . . . . . . . . . . . . . . . . . . . . . 195 10-16 Implementationsof ifTrue:ifFalse: . . . . . . . . . . . . . . . . . . . 196 10-17 Implementingnegation . . . . . . . . . . . . . . . . . . . . . . . . . . . . 196 10-18 SomeofthekeycollectionclassesinPharo. . . . . . . . . . . . . . . . . . 198 10-19 Somecollectionclassescategorizedbyimplementationtechnique. . . . . . 200 10-20 Redefining=and hash.. . . . . . . . . . . . . . . . . . . . . . . . . . . . 219 11-1 Astreampositionedatitsbeginning. . . . . . . . . . . . . . . . . . . . . . 221 11-2 Thesamestreamaftertheexecutionofthemethod next: thecharacter aisin the past whereas b,c,dandearein the future .. . . . . . . . . . . . . 222 11-3 Thesamestreamafterhavingwrittenan x.. . . . . . . . . . . . . . . . . . 222 11-4 Astreamatposition2. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 225 11-5. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 226 11-6. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 227 11-7. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22